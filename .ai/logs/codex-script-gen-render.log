==== spawn @ 2026-02-08T03:37:37.744Z ====
cmd: codex "exec" "--cd" "/Users/johnlindquist/dev/script-kit-gpui" "--model" "gpt-5.3-codex" "-c" "model_reasoning_effort=\"xhigh\"" "-c" "model_auto_compact_token_limit=120000" "-c" "developer_instructions=\"You are Codex implementer agent \\\"codex-script-gen-render\\\".\\n\\n## Coordination\\nThis repo runs parallel agents in ONE working tree. Before editing any file, you MUST claim it.\\nCommands (run via shell):\\n  - View roster: ~/.claude/bin/swarm.ts status\\n  - Claim files (blocks until free): ~/.claude/bin/swarm.ts claim --wait --id codex-script-gen-render path/to/file\\n  - Release: ~/.claude/bin/swarm.ts release --id codex-script-gen-render path/to/file\\n  - Update status/notes: ~/.claude/bin/swarm.ts update --id codex-script-gen-render --status in_progress --notes \\\"...\\\"\\nRules:\\n  - Never edit a file you haven't claimed.\\n  - Keep claims tight (claim only what you're actively changing).\\n  - If blocked, set status=blocked and say what you're waiting on.\\n  - When finished, set status=done and release claims.\\n\\n## Development practices (this code is maintained by AI agents)\\n  - Log state transitions with enough context to diagnose failures from logs alone.\\n  - Structured errors: include what was attempted, what failed, and current state.\\n  - Name things for grepability — unique identifiers agents can find on the first search.\\n  - Every behavior change gets a test. Untested code is invisible to the next agent.\\n  - Test names describe the scenario: test_X_does_Y_when_Z.\\n  - Keep functions small and single-purpose. 500-line functions burn agent context.\\n  - Use types to encode constraints (enums > strings for errors).\\n\\n## CRITICAL: Parallel-safe verification\\n  - Other agents are modifying other files RIGHT NOW. Full test suites WILL show their failures.\\n  - ONLY run tests that cover YOUR changed files. Scope every test/check command:\\n    Rust: cargo test -p your-crate -- module::test_name | JS: npx jest your/file.test.ts\\n  - Do NOT run: cargo test (unscoped), cargo check (whole workspace), npm test (unscoped).\\n  - If a scoped test fails, it's YOUR bug — fix it. If tests outside your scope fail, ignore them.\\n\\n## Git commit discipline\\n  - NEVER commit unverified work. Run tests/lints/type-checks FIRST. If it fails, fix it before committing.\\n  - A commit is a declaration: \\\"this works and here's the proof.\\\"\\n  - Commit FREQUENTLY — after each meaningful unit of VERIFIED work, not just at the end.\\n  - A \\\"unit\\\" = one logical change that passes verification (new function, bug fix, refactor, test added).\\n  - NEVER batch an entire task into one giant commit. Small commits are searchable; big ones aren't.\\n  - Commit message format:\\n      Line 1: <type>(<scope>): <what changed> (imperative, max 72 chars)\\n      Line 3+: WHY this change was made, WHAT was verified, and HOW to test it.\\n    Types: feat, fix, refactor, test, docs, chore\\n    Example:\\n      feat(auth): add refresh token rotation\\n      \\n      Tokens now rotate on each refresh call to prevent replay attacks.\\n      The old token is invalidated immediately on rotation.\\n      \\n      Verified: cargo test --lib -- auth::refresh (4 tests pass)\\n      Verified: manual smoke test via curl — token rotates, old token returns 401\\n  - The \\\"Verified:\\\" lines are REQUIRED. Future agents will read git log to understand\\n    what was tested and how to re-verify. This is the most valuable part of the message.\\n  - In your final message, list all commits you made with their hashes.\\n\\n## Time budget\\nYou have approximately 10 minutes. If your task is too broad to complete in time:\\n(1) Commit any verified progress.\\n(2) Run: ~/.claude/bin/swarm.ts update --id YOUR_ID --status needs_split --notes 'suggest: 1) sub-task-desc scope:files 2) sub-task-desc scope:files'.\\n(3) Exit cleanly. The dispatcher will read your suggestions and spawn narrower workers.\"" "--output-last-message" "/Users/johnlindquist/dev/script-kit-gpui/.ai/logs/codex-script-gen-render.final.md" "--yolo" "You are agent codex-script-gen-render.\n\nCurrent parallel-agent roster (read this first):\n```\nSWARM SNAPSHOT @ 2026-02-08T03:37:37.741Z\n- codex-script-gen-render [starting] scope=src/prompts/chat/render_core.rs,src/prompts/chat/render_footer.rs,src/prompts/chat/render_messages.rs,src/prompts/chat/prompt.rs,src/prompts/chat/mod.rs task=Previous worker added script generation mode to ChatPrompt (with_script_generation_mode, ScriptGenerationAction enum wi…\n```\n\nYour assignment:\n- Task: Previous worker added script generation mode to ChatPrompt (with_script_generation_mode, ScriptGenerationAction enum with Save/Run/SaveAndRun, handle_script_generation_action, should_show_script_generation_actions helper, latest_script_generation_draft, clear_script_generation_status, set_script_generation_status). What's MISSING is the rendering of Save/Run/Save and Run buttons in the chat prompt UI. Add a render method that shows three buttons (Save, Run, Save and Run) when should_show_script_generation_actions() returns true (script_generation_mode=true, not streaming, has a draft response). The buttons should call handle_script_generation_action(ScriptGenerationAction::Save/Run/SaveAndRun). Also show script_generation_status text (error in red, success in green) when set. Look at how existing buttons are rendered in the chat prompt render files (src/prompts/chat/render_core.rs, render_footer.rs, render_messages.rs) for UI patterns. Use theme.colors for styling. The buttons should appear near the bottom/footer area of the chat, below the last message. Also make sure cargo check passes.\n- Scope: src/prompts/chat/render_core.rs,src/prompts/chat/render_footer.rs,src/prompts/chat/render_messages.rs,src/prompts/chat/prompt.rs,src/prompts/chat/mod.rs\n\nOperating constraints:\n- Single working tree (no worktrees, no patches).\n- You MUST claim files before editing (~/.claude/bin/swarm.ts claim --wait ...).\n\nDeliverables:\n- Make the code changes required by the task.\n- Run the most relevant tests/linters.\n- In your FINAL message, include: changed files, how to test, and any risks/known gaps."

OpenAI Codex v0.98.0 (research preview)
--------
workdir: /Users/johnlindquist/dev/script-kit-gpui
model: gpt-5.3-codex
provider: openai
approval: never
sandbox: danger-full-access
reasoning effort: xhigh
reasoning summaries: auto
session id: 019c3b53-8f0a-7cc2-b82c-c58c68f9b78b
--------
user
You are agent codex-script-gen-render.

Current parallel-agent roster (read this first):
```
SWARM SNAPSHOT @ 2026-02-08T03:37:37.741Z
- codex-script-gen-render [starting] scope=src/prompts/chat/render_core.rs,src/prompts/chat/render_footer.rs,src/prompts/chat/render_messages.rs,src/prompts/chat/prompt.rs,src/prompts/chat/mod.rs task=Previous worker added script generation mode to ChatPrompt (with_script_generation_mode, ScriptGenerationAction enum wi…
```

Your assignment:
- Task: Previous worker added script generation mode to ChatPrompt (with_script_generation_mode, ScriptGenerationAction enum with Save/Run/SaveAndRun, handle_script_generation_action, should_show_script_generation_actions helper, latest_script_generation_draft, clear_script_generation_status, set_script_generation_status). What's MISSING is the rendering of Save/Run/Save and Run buttons in the chat prompt UI. Add a render method that shows three buttons (Save, Run, Save and Run) when should_show_script_generation_actions() returns true (script_generation_mode=true, not streaming, has a draft response). The buttons should call handle_script_generation_action(ScriptGenerationAction::Save/Run/SaveAndRun). Also show script_generation_status text (error in red, success in green) when set. Look at how existing buttons are rendered in the chat prompt render files (src/prompts/chat/render_core.rs, render_footer.rs, render_messages.rs) for UI patterns. Use theme.colors for styling. The buttons should appear near the bottom/footer area of the chat, below the last message. Also make sure cargo check passes.
- Scope: src/prompts/chat/render_core.rs,src/prompts/chat/render_footer.rs,src/prompts/chat/render_messages.rs,src/prompts/chat/prompt.rs,src/prompts/chat/mod.rs

Operating constraints:
- Single working tree (no worktrees, no patches).
- You MUST claim files before editing (~/.claude/bin/swarm.ts claim --wait ...).

Deliverables:
- Make the code changes required by the task.
- Run the most relevant tests/linters.
- In your FINAL message, include: changed files, how to test, and any risks/known gaps.
warning: Under-development features enabled: responses_websockets. Under-development features are incomplete and may behave unpredictably. To suppress this warning, set `suppress_unstable_features_warning = true` in /Users/johnlindquist/.codex/config.toml.
mcp: deepwiki starting
mcp: deepwiki ready
mcp startup: ready: deepwiki

thinking
**Acknowledging task and planning claims**
codex
Implementing the missing chat UI actions now. I’ll inspect the existing chat render files to mirror current button/status patterns, then claim only the files I need and add the Save/Run/Save and Run footer actions wired to `handle_script_generation_action`.

thinking
**Planning parallel file inspection**
exec
/bin/zsh -lc 'ls -1 src/prompts/chat' in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc "~/.claude/bin/swarm.ts status && echo '---' && rg -n \"script_generation|ScriptGenerationAction|should_show_script_generation_actions|handle_script_generation_action\" src/prompts/chat -S" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 53ms:
actions.rs
mod.rs
prompt.rs
render_core.rs
render_input.rs
render_setup.rs
render_turns.rs
state.rs
streaming.rs
tests.rs
types.rs
 succeeded in 51ms:
Repo: /Users/johnlindquist/dev/script-kit-gpui
Updated: 2026-02-08T03:37:49.501Z

Active agents (1):
codex-script-gen-render [in_progress] codex/gpt-5.3-codex/exec
  task: Previous worker added script generation mode to ChatPrompt (with_script_generation_mode, ScriptGenerationAction enum wi…
  scope: src/prompts/chat/render_core.rs,src/prompts/chat/render_footer.rs,src/prompts/chat/render_messages.rs,src/prompts/chat/…
  claims: (none)
  notes: spawned codex (exec)

Inactive agents (265):
- codex-accessibility [done] done. exit=0. final=.ai/logs/codex-accessibility.final.md. See final message file.
- codex-action-labels [failed] failed. exit=1. final=.ai/logs/codex-action-labels.final.md.
- codex-actions-audit [failed] failed. exit=1. final=.ai/logs/codex-actions-audit.final.md. See final message file.
- codex-actions-consistency [failed] failed. exit=1. final=.ai/logs/codex-actions-consistency.final.md.
- codex-actions-dialog [done] done. exit=0. final=.ai/logs/codex-actions-dialog.final.md. See final message file.
- codex-actions-feedback [failed] failed. exit=1. final=.ai/logs/codex-actions-feedback.final.md.
- codex-actions-feedback-v2 [done] done. exit=0. final=.ai/logs/codex-actions-feedback-v2.final.md. See final message file.
- codex-actions-ux [done] done. exit=0. final=.ai/logs/codex-actions-ux.final.md. See final message file.
- codex-agents-md [done] done. exit=0. final=.ai/logs/codex-agents-md.final.md. See final message file.

thinking
**Assessing rendering file contents**
codex
I found the script-generation plumbing already present in `prompt.rs`, `actions.rs`, and `types.rs`. Next I’m inspecting current chat rendering code to add a footer action row in the existing render structure (it looks like this repo uses `render_turns.rs`/`render_input.rs` rather than separate footer/messages files).

thinking
**Preparing file inspection commands**
exec
/bin/zsh -lc "nl -ba src/prompts/chat/render_core.rs | sed -n '1,260p'" in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc "nl -ba src/prompts/chat/render_turns.rs | sed -n '1,320p'" in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc "nl -ba src/prompts/chat/prompt.rs | sed -n '430,620p'" in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc "nl -ba src/prompts/chat/render_input.rs | sed -n '1,360p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 50ms:
     1	use super::*;
     2	
     3	impl ChatPrompt {
     4	    fn render_footer(&self, _cx: &mut Context<Self>) -> impl IntoElement {
     5	        // Use standard PromptFooter colors from theme
     6	        let footer_colors = PromptFooterColors::from_theme(&self.theme);
     7	
     8	        // Build model display text (show model name if available)
     9	        let model_text = self.model.clone().unwrap_or_else(|| "Select Model".into());
    10	
    11	        // Configure footer with chat-specific labels
    12	        let footer_config = PromptFooterConfig::new()
    13	            .primary_label("Continue in Chat")
    14	            .primary_shortcut("⌘↵")
    15	            .secondary_label("Actions")
    16	            .secondary_shortcut("⌘K")
    17	            .show_logo(true)
    18	            .show_secondary(true)
    19	            .helper_text(model_text) // Show model name next to logo
    20	            .info_label("Shift+Enter newline");
 succeeded in 51ms:
   430	            return false;
   431	        }
   432	        let (next_index, action, changed) =
   433	            resolve_setup_card_key(key, shift, self.setup_focus_index);
   434	        let handled = changed || !matches!(action, SetupCardAction::None);
   435	
   436	        if changed {
   437	            self.setup_focus_index = next_index;
   438	            cx.notify();
   439	        }
   440	
   441	        match action {
   442	            SetupCardAction::ActivateConfigure => {
   443	                if let Some(ref callback) = self.on_configure {
   444	                    callback();
   445	                }
   446	            }
   447	            SetupCardAction::ActivateClaudeCode => {
   448	                if let Some(ref callback) = self.on_claude_code {
   449	                    callback();
 succeeded in 52ms:
     1	use super::*;
     2	
     3	impl ChatPrompt {
     4	    pub(super) fn render_turn(
     5	        &self,
     6	        turn: &ConversationTurn,
     7	        turn_index: usize,
     8	        cx: &Context<Self>,
     9	    ) -> impl IntoElement {
    10	        let colors = &self.prompt_colors;
    11	
    12	        // VIBRANCY: Use theme-aware overlay for subtle lift that lets blur show through
    13	        // Dark mode: white overlay brightens; Light mode: much subtler black overlay
    14	        let container_bg = if self.theme.is_dark_mode() {
    15	            theme::hover_overlay_bg(&self.theme, 0x15) // ~8% white overlay for dark mode
    16	        } else {
    17	            theme::hover_overlay_bg(&self.theme, 0x08) // ~3% black overlay for light mode
    18	        };
    19	        let copy_hover_bg = theme::hover_overlay_bg(&self.theme, 0x28); // ~16% for hover
    20	        let error_color = self.theme.colors.ui.error;
 succeeded in 50ms:
     1	use super::*;
     2	
     3	impl ChatPrompt {
     4	    pub(super) fn render_input(&self, is_focused: bool) -> impl IntoElement {
     5	        let colors = &self.prompt_colors;
     6	        let theme_colors = &self.theme.colors;
     7	        let text = self.input.text();
     8	        let cursor_pos = self.input.cursor();
     9	        let chars: Vec<char> = text.chars().collect();
    10	        let cursor_visible = self.cursor_visible && is_focused;
    11	
    12	        let mut input_content = div()
    13	            .flex()
    14	            .flex_row()
    15	            .items_center()
    16	            .w_full()
    17	            .text_size(px(14.0));
    18	
    19	        // Text before cursor
    20	        if cursor_pos > 0 {

thinking
**Inspecting render_core continuation**
codex
I’ve confirmed the logic helpers are ready; now I’m locating the exact render tree insertion point so the new action row lands below the conversation messages and above the existing footer.
exec
/bin/zsh -lc "nl -ba src/prompts/chat/render_core.rs | sed -n '240,520p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
   240	                )
   241	                .into_any_element();
   242	        }
   243	
   244	        // Input area at TOP
   245	        let has_pending_image = self.pending_image.is_some();
   246	        let input_area = div()
   247	            .w_full()
   248	            .px(px(12.0))
   249	            .py(px(8.0))
   250	            .flex()
   251	            .flex_col()
   252	            .gap(px(8.0))
   253	            .border_b_1()
   254	            .border_color(rgba((colors.quote_border << 8) | 0x40))
   255	            .on_drop(cx.listener(|this, paths: &ExternalPaths, _window, cx| {
   256	                this.handle_file_drop(paths, cx);
   257	            }))
   258	            .when(has_pending_image, |d| {
   259	                d.child(self.render_pending_image_preview(cx))

thinking
**Assessing footer rendering integration**
exec
/bin/zsh -lc "nl -ba src/prompts/chat/mod.rs | sed -n '1,260p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
     1	//! ChatPrompt - Raycast-style chat interface
     2	//!
     3	//! Features:
     4	//! - Input at TOP (not bottom)
     5	//! - Messages bundled as conversation turns (user prompt + AI response in same container)
     6	//! - Full-width containers (not bubbles)
     7	//! - Footer with model selector and "Continue in Chat"
     8	//! - Actions menu (⌘+K) with model picker
     9	
    10	use crate::components::prompt_footer::{PromptFooter, PromptFooterColors, PromptFooterConfig};
    11	use crate::components::TextInputState;
    12	use crate::designs::icon_variations::IconName;
    13	use gpui::{
    14	    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
    15	    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
    16	    RenderImage, ScrollWheelEvent, Timer, Window,
    17	};
    18	use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
    19	use std::collections::HashMap;
    20	use std::sync::atomic::{AtomicBool, Ordering};

thinking
**Weighing module organization**
exec
/bin/zsh -lc "nl -ba src/prompts/chat/types.rs | sed -n '90,220p'" in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc "nl -ba src/prompts/chat/actions.rs | sed -n '100,270p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
    90	    if key.eq_ignore_ascii_case("up") || key.eq_ignore_ascii_case("arrowup") {
    91	        let next_index = if current_index == 0 {
    92	            1
    93	        } else {
    94	            current_index - 1
    95	        };
    96	        return (next_index, SetupCardAction::None, true);
    97	    }
    98	
    99	    if key.eq_ignore_ascii_case("down") || key.eq_ignore_ascii_case("arrowdown") {
   100	        let next_index = (current_index + 1) % 2;
   101	        return (next_index, SetupCardAction::None, true);
   102	    }
   103	
   104	    if key.eq_ignore_ascii_case("enter") || key.eq_ignore_ascii_case("return") || key == " " {
   105	        let action = if current_index == 0 {
   106	            SetupCardAction::ActivateConfigure
   107	        } else {
   108	            SetupCardAction::ActivateClaudeCode
   109	        };
 succeeded in 51ms:
   100	        logging::log(
   101	            "CHAT",
   102	            &format!("Transferring {} messages to AI window", messages.len()),
   103	        );
   104	
   105	        // Open AI window with the chat history
   106	        if let Err(e) = ai::open_ai_window_with_chat(cx, messages) {
   107	            logging::log("CHAT", &format!("Failed to open AI window: {}", e));
   108	        }
   109	
   110	        // Close this prompt by calling the escape callback
   111	        if let Some(ref callback) = self.on_escape {
   112	            callback(self.id.clone());
   113	        }
   114	    }
   115	
   116	    pub fn handle_copy_last_response(&mut self, cx: &mut Context<Self>) {
   117	        // Find the last assistant message
   118	        if let Some(last_assistant) = self.messages.iter().rev().find(|m| !m.is_user()) {
   119	            let content = last_assistant.get_content().to_string();

thinking
**Scoping footer rendering**
exec
/bin/zsh -lc "nl -ba src/prompts/chat/prompt.rs | sed -n '1,220p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
     1	use super::*;
     2	pub struct ChatPrompt {
     3	    pub id: String,
     4	    pub messages: Vec<ChatPromptMessage>,
     5	    pub placeholder: Option<String>,
     6	    pub hint: Option<String>,
     7	    pub footer: Option<String>,
     8	    pub model: Option<String>,
     9	    pub models: Vec<ChatModel>,
    10	    pub title: Option<String>,
    11	    pub focus_handle: FocusHandle,
    12	    pub input: TextInputState,
    13	    pub on_submit: ChatSubmitCallback,
    14	    pub on_escape: Option<ChatEscapeCallback>,
    15	    pub on_continue: Option<ChatContinueCallback>,
    16	    pub on_retry: Option<ChatRetryCallback>,
    17	    pub theme: Arc<theme::Theme>,
    18	    pub turns_list_state: ListState,
    19	    pub(super) prompt_colors: theme::PromptColors,
    20	    pub(super) conversation_turns_cache: Arc<Vec<ConversationTurn>>,

thinking
**Inspecting existing render tests**
exec
/bin/zsh -lc "nl -ba src/prompts/chat/tests.rs | sed -n '1,420p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
     1	use super::*;
     2	#[cfg(test)]
     3	#[allow(clippy::module_inception)]
     4	mod tests {
     5	    use std::collections::HashMap;
     6	
     7	    use crate::protocol::ChatPromptMessage;
     8	
     9	    use super::{
    10	        next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
    11	        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
    12	        ChatScrollDirection, SetupCardAction,
    13	    };
    14	
    15	    #[test]
    16	    fn resolve_setup_card_key_cycles_focus_for_tab_and_arrows() {
    17	        assert_eq!(
    18	            resolve_setup_card_key("tab", false, 0),
    19	            (1, SetupCardAction::None, true)
    20	        );

thinking
**Planning helper unit tests**
exec
/bin/zsh -lc '~/.claude/bin/swarm.ts update --id codex-script-gen-render --status in_progress --notes "inspecting chat render tree to add script-generation action footer row and status"' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
Updated: codex-script-gen-render

thinking
**Claiming relevant source files**
codex
I’ve found the exact insertion point in `render_core.rs` (between messages and existing footer). Next I’m claiming `render_core.rs` and `tests.rs`, then implementing a dedicated script-generation action row and status line with theme-based colors and click handlers.
exec
/bin/zsh -lc '~/.claude/bin/swarm.ts claim --wait --id codex-script-gen-render src/prompts/chat/render_core.rs' in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc '~/.claude/bin/swarm.ts claim --wait --id codex-script-gen-render src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 50ms:
Claimed for codex-script-gen-render: src/prompts/chat/render_core.rs
 succeeded in 50ms:
Claimed for codex-script-gen-render: src/prompts/chat/tests.rs

thinking
**Planning render additions and styling**
exec
/bin/zsh -lc "rg -n \"theme\\.colors\\..*(green|success|error|warning|accent|terminal|ansi)\" src | head -n 80" in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc "rg -n \"struct .*Colors|pub struct .*Theme|ansi\\.green|ui\\.error\" src/theme -S" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
src/warning_banner.rs:222:// - WarningBanner::from_theme() uses theme.colors.ui.warning
src/ui_foundation/part_000.rs:171:            accent: theme.colors.accent.selected,
src/components/prompt_input.rs:283:            accent: theme.colors.accent.selected,
src/components/toast/tests.rs:13:    theme.colors.accent.selected_subtle = 0x334455;
src/components/prompt_header/tests.rs:18:    theme.colors.text.on_accent = 0x223344;
src/components/prompt_header/types.rs:89:            accent: theme.colors.accent.selected,
src/components/prompt_header/types.rs:93:            logo_icon: theme.colors.text.on_accent,
src/components/prompt_header/types.rs:94:            hover_overlay: Self::overlay_with_alpha(theme.colors.accent.selected_subtle, 0x26),
src/components/button/tests.rs:44:    theme.colors.accent.selected_subtle = 0x112233;
src/components/button/types.rs:73:        let hover_overlay = Self::overlay_with_alpha(theme.colors.accent.selected_subtle, 0x26);
src/components/button/types.rs:76:            text_color: theme.colors.accent.selected, // Yellow/gold - matches logo & highlights
src/components/button/types.rs:78:            background: theme.colors.accent.selected_subtle,
src/components/button/types.rs:79:            background_hover: theme.colors.accent.selected_subtle,
src/components/button/types.rs:80:            accent: theme.colors.accent.selected, // Yellow/gold - matches logo & highlights
src/components/button/types.rs:82:            focus_ring: theme.colors.accent.selected, // Accent color for focus ring
src/components/button/types.rs:83:            focus_tint: theme.colors.accent.selected_subtle, // Subtle tint when focused
src/components/form_fields/colors.rs:40:            .unwrap_or(theme.colors.accent.selected);
src/components/form_fields/colors.rs:48:            border_focused: theme.colors.accent.selected,
src/components/form_fields/colors.rs:50:            checkbox_checked: theme.colors.accent.selected,
src/list_item/part_001.rs:10:            accent_selected: theme.colors.accent.selected,
 succeeded in 51ms:
src/theme/presets/part_01.rs:9:pub struct ThemePreset {
src/theme/presets/part_01.rs:32:pub struct PresetPreviewColors {
src/theme/gpui_integration.rs:178:    theme_color.danger = hex_to_hsla(colors.ui.error);
src/theme/validation.rs:81:pub struct ThemeDiagnostics {
src/theme/helpers.rs:19:pub struct ListItemColors {
src/theme/helpers.rs:125:pub struct InputFieldColors {
src/theme/helpers.rs:180:pub struct PromptColors {
src/theme/color_resolver.rs:122:            error: colors.ui.error,
src/theme/semantic.rs:163:pub struct SemanticColors {
src/theme/types/part_01.rs:347:pub struct BackgroundColors {
src/theme/types/part_05.rs:294:        error = format!("#{:06x}", theme.colors.ui.error),
src/theme/types/part_02.rs:3:pub struct TextColors {
src/theme/types/part_02.rs:31:pub struct AccentColors {
src/theme/types/part_02.rs:50:pub struct UIColors {
src/theme/types/part_02.rs:73:pub struct TerminalColors {
src/theme/types/part_02.rs:363:pub struct Theme {
src/theme/types/part_03.rs:115:                error: darken_hex(self.ui.error),

thinking
**Inspecting theme types for fields**
exec
/bin/zsh -lc "nl -ba src/theme/types/part_02.rs | sed -n '40,140p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
    40	}
    41	
    42	/// Default subtle selection color
    43	/// Uses white for near-invisible Raycast-like highlighting
    44	fn default_selected_subtle() -> HexColor {
    45	    0xffffff // White - rendered at very low opacity for subtle brightening
    46	}
    47	
    48	/// Border and UI element colors
    49	#[derive(Debug, Clone, Serialize, Deserialize)]
    50	pub struct UIColors {
    51	    /// Border color (#464647)
    52	    #[serde(with = "hex_color_serde")]
    53	    pub border: HexColor,
    54	    /// Success color for logs (#00FF00 - green)
    55	    #[serde(with = "hex_color_serde")]
    56	    pub success: HexColor,
    57	    /// Error color for error messages (#EF4444 - red-500)
    58	    #[serde(default = "default_error_color", with = "hex_color_serde")]
    59	    pub error: HexColor,

thinking
**Confirming theme color usage**
exec
/bin/zsh -lc "rg -n \"\\.on_click\\(cx\\.listener\\(|cursor_pointer\\(\\)|text_xs\\(\\).*child\\(\\\".*\\\"\\)\" src/prompts -g\"*.rs\" | head -n 120" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 50ms:
src/prompts/env/render.rs:306:                                                .cursor_pointer()
src/prompts/chat/render_turns.rs:75:                        .cursor_pointer()
src/prompts/chat/render_turns.rs:81:                        .on_click(cx.listener(move |this, _, _window, _cx| {
src/prompts/chat/render_turns.rs:114:                content = content.child(div().text_xs().opacity(0.6).child("Thinking..."));
src/prompts/chat/render_turns.rs:152:            .cursor_pointer()
src/prompts/chat/render_turns.rs:161:            .on_click(cx.listener(move |this, _, _window, cx| {
src/prompts/chat/render_core.rs:345:                                    .cursor_pointer()
src/prompts/chat/render_core.rs:347:                                    .on_click(cx.listener(|this, _event, _window, cx| {
src/prompts/chat/render_setup.rs:87:                            .cursor_pointer()
src/prompts/chat/render_setup.rs:103:                            .on_click(cx.listener(move |_this, _event, _window, _cx| {
src/prompts/chat/render_setup.rs:145:                            .cursor_pointer()
src/prompts/chat/render_setup.rs:161:                            .on_click(cx.listener(move |_this, _event, _window, _cx| {
src/prompts/chat/state.rs:270:                            .cursor_pointer()
src/prompts/chat/state.rs:275:                            .on_click(cx.listener(move |this, _, _window, cx| {
src/prompts/chat/state.rs:457:                    .cursor_pointer()
src/prompts/markdown/code_table.rs:94:                        .cursor_pointer()
src/prompts/markdown/inline_render.rs:36:                    .cursor_pointer()
src/prompts/div/inline.rs:150:        piece = piece.text_color(rgb(ctx.accent_color)).cursor_pointer();

thinking
**Inspecting style definitions**
exec
/bin/zsh -lc "nl -ba src/prompts/chat/state.rs | sed -n '230,340p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
   230	        cx.notify();
   231	    }
   232	
   233	    /// Render conversation starters for empty state
   234	    pub(super) fn render_conversation_starters(&self, cx: &Context<Self>) -> impl IntoElement {
   235	        let colors = &self.prompt_colors;
   236	        let starters = self.get_conversation_starters(cx);
   237	
   238	        // Chip styling - use theme-aware overlays
   239	        let chip_bg = theme::hover_overlay_bg(&self.theme, 0x20);
   240	        let chip_hover_bg = theme::hover_overlay_bg(&self.theme, 0x35);
   241	
   242	        div()
   243	            .flex()
   244	            .flex_col()
   245	            .items_center()
   246	            .justify_center()
   247	            .flex_1()
   248	            .gap(px(16.))
   249	            .child(

thinking
**Designing script generation actions**
codex
I’m now editing `render_core.rs` to add a dedicated script-generation action/status renderer and wiring it into the main layout just above the existing footer, then I’ll add focused unit tests for the visibility/action logic in `tests.rs`.

thinking
**Preparing patch for render core**
file update
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/render_core.rs
@@ -26,2 +26,86 @@
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
@@ -389,2 +473,6 @@
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
apply_patch(auto_approved=true) exited 0 in 11ms:
Success. Updated the following files:
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/render_core.rs
file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback

file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback


thinking
**Adding imports and tests**
file update
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/tests.rs
@@ -10,4 +10,5 @@
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
@@ -155,2 +156,38 @@
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
apply_patch(auto_approved=true) exited 0 in 17ms:
Success. Updated the following files:
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/tests.rs
file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]

file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Planning scoped Rust checks and tests**
exec
/bin/zsh -lc 'rg -n "''^name'"\\s*=\\s*\\\"\" Cargo.toml | head -n 5" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
2:name = "script-kit-gpui"
8:name = "script_kit_gpui"
12:name = "script-kit-gpui"
17:name = "smoke-test"
22:name = "storybook"
file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Preparing commentary update before tests**
codex
Edits are in place for the action row and status text. I’m running scoped verification now (`cargo check` for this crate plus targeted chat tests for the new script-generation visibility/action behavior).

thinking
**Planning targeted check and tests**
exec
/bin/zsh -lc 'cargo check -p script-kit-gpui' in /Users/johnlindquist/dev/script-kit-gpui exited 101 in 7.11s:
    Checking script-kit-gpui v0.1.0 (/Users/johnlindquist/dev/script-kit-gpui)
error[E0412]: cannot find type `AnyElement` in this scope
  --> src/prompts/chat/render_core.rs:28:82
   |
28 |     fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
   |                                                                                  ^^^^^^^^^^
   |
  ::: /Users/johnlindquist/.cargo/git/checkouts/zed-a70e2ad075855582/94faaeb/crates/gpui/src/element.rs:51:1
   |
51 | pub trait Element: 'static + IntoElement {
   | ---------------------------------------- similarly named trait `Element` defined here
   |
   = note: struct `crate::notes::window::window_ops::AnyElement` exists but is inaccessible
help: a trait with a similar name exists
   |
28 -     fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
28 +     fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<Element> {
   |
help: consider importing this struct
   |
file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Fixing import and type inference errors**
codex
`cargo check` failed on two compile issues from the new code: missing `AnyElement` import and a `when_some` type inference error. I’m applying a minimal fix (import + explicit closure type) and rerunning scoped checks.
exec
/bin/zsh -lc '~/.claude/bin/swarm.ts claim --wait --id codex-script-gen-render src/prompts/chat/mod.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:
Claimed for codex-script-gen-render: src/prompts/chat/mod.rs
file update:
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Patching closure annotations**
file update
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/mod.rs
@@ -13,3 +13,4 @@
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
apply_patch(auto_approved=true) exited 0 in 19ms:
Success. Updated the following files:
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/mod.rs
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]

file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..82bb565bdfbb22d5f0043afbde4f8aea65998ea1
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Attempting render patch for closure annotation**
file update
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/render_core.rs
@@ -474,3 +474,3 @@
             // Script generation save/run actions (shown for generated drafts when available)
-            .when_some(self.render_script_generation_actions(cx), |d, actions| {
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
                 d.child(actions)
apply_patch(auto_approved=true) exited 0 in 20ms:
Success. Updated the following files:
M /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/render_core.rs
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]

file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Running build verification**
exec
/bin/zsh -lc 'cargo check -p script-kit-gpui' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 24.34s:
    Blocking waiting for file lock on build directory
    Checking script-kit-gpui v0.1.0 (/Users/johnlindquist/dev/script-kit-gpui)
warning: glob import doesn't reexport anything with visibility `pub(in crate::prompts)` because no imported item is public enough
  --> src/prompts/div/mod.rs:32:16
   |
32 | pub(super) use inline::*;
   |                ^^^^^^^^^
   |
note: the most public imported item is `pub(self)`
  --> src/prompts/div/mod.rs:32:16
   |
32 | pub(super) use inline::*;
   |                ^^^^^^^^^
   = help: reduce the glob import's visibility or increase visibility of imported items
   = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: glob import doesn't reexport anything with visibility `pub(in crate::prompts)` because no imported item is public enough
  --> src/prompts/div/mod.rs:34:16
   |
34 | pub(super) use render_html::*;
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Running targeted tests sequentially**
exec
/bin/zsh -lc 'cargo test -p script-kit-gpui should_show_script_generation_actions_only_when_draft_is_ready -- --exact' in /Users/johnlindquist/dev/script-kit-gpui exited 101 in 18.99s:
warning: glob import doesn't reexport anything with visibility `pub(in crate::prompts)` because no imported item is public enough
  --> src/prompts/div/mod.rs:32:16
   |
32 | pub(super) use inline::*;
   |                ^^^^^^^^^
   |
note: the most public imported item is `pub(self)`
  --> src/prompts/div/mod.rs:32:16
   |
32 | pub(super) use inline::*;
   |                ^^^^^^^^^
   = help: reduce the glob import's visibility or increase visibility of imported items
   = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: glob import doesn't reexport anything with visibility `pub(in crate::prompts)` because no imported item is public enough
  --> src/prompts/div/mod.rs:34:16
   |
34 | pub(super) use render_html::*;
   |                ^^^^^^^^^^^^^^
   |
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Assessing scoped test limitations**
codex
`cargo check -p script-kit-gpui` is passing with the new UI changes. I attempted a scoped unit-test run, but this workspace currently has unrelated pre-existing test-module compilation failures that block any `cargo test` execution; I’ll include those exact limitations in the handoff.
exec
/bin/zsh -lc "git status --short && echo '---' && git diff -- src/prompts/chat/mod.rs src/prompts/chat/render_core.rs src/prompts/chat/tests.rs" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 50ms:
 M .ai/logs/codex-audit-act-description-quality-v2.final.md
 M .ai/logs/codex-audit-act-execution-builtin.final.md
 M .ai/logs/codex-audit-act-execution-scripts.final.md
 M .ai/logs/codex-audit-act-keyboard-nav.final.md
 M .ai/logs/codex-audit-act-section-grouping.final.md
 M .ai/logs/codex-audit-act-theme-dialog-render.final.md
 M .ai/roster.json
 M src/actions/builders.rs
 M src/actions/builders/chat.rs
 M src/actions/builders/clipboard.rs
 M src/actions/builders/file_path.rs
 M src/actions/builders/notes.rs
 M src/actions/builders/script_context.rs
 M src/actions/builders/scriptlet.rs
 M src/actions/builders/shared.rs
 M src/actions/command_bar/part_01.rs
 M src/actions/command_bar/part_02.rs
 M src/actions/constants.rs
 M src/actions/dialog/part_01.rs
 M src/actions/dialog/part_02/part_01.rs
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Verifying import duplication in mod.rs**
codex
I’m reviewing the final diff now to ensure only the requested chat UI behavior changed and that there’s no accidental overlap with other in-flight agent edits before I release claims.
exec
/bin/zsh -lc "nl -ba src/prompts/chat/mod.rs | sed -n '44,70p' && echo '---' && nl -ba src/prompts/chat/render_core.rs | sed -n '1,170p'" in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
    44	mod tests;
    45	mod types;
    46	
    47	#[cfg(test)]
    48	pub(crate) use tests::chat_tests;
    49	
    50	use self::types::{
    51	    build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
    52	    next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
    53	    should_ignore_stream_reveal_update, should_show_script_generation_actions,
    54	    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
    55	};
    56	
    57	pub use prompt::ChatPrompt;
    58	pub use types::{
    59	    default_models, ChatClaudeCodeCallback, ChatConfigureCallback, ChatContinueCallback,
    60	    ChatErrorType, ChatEscapeCallback, ChatModel, ChatRetryCallback, ChatShowActionsCallback,
    61	    ChatSubmitCallback, ConversationStarter, ConversationTurn,
    62	};
---
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Checking for concurrent edits**
exec
/bin/zsh -lc 'git diff --check -- src/prompts/chat/mod.rs src/prompts/chat/render_core.rs src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:

file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..ced2797153e26b9e7fa557b5eabd5316f1c3c5e1
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,7 +11,8 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle,
     Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
     RenderImage, ScrollWheelEvent, Timer, Window,
 };
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..89d125c7328fed8733af27652b149a717dca9646
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,10 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(self.render_script_generation_actions(cx), |d, actions: AnyElement| {
+                d.child(actions)
+            })
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Planning targeted Rust formatting**
exec
/bin/zsh -lc 'cargo fmt -- src/prompts/chat/mod.rs src/prompts/chat/render_core.rs src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpui exited 1 in 113ms:
Error writing files: failed to resolve mod `tests`: file for module found at both "/Users/johnlindquist/dev/script-kit-gpui/src/protocol/message/tests.rs" and "/Users/johnlindquist/dev/script-kit-gpui/src/protocol/message/tests/mod.rs"
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Running rustfmt directly on files**
exec
/bin/zsh -lc 'rustfmt src/prompts/chat/mod.rs src/prompts/chat/render_core.rs src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpui exited 1 in 51ms:
error: `async move` blocks are only allowed in Rust 2018 or later
   --> /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/prompt.rs:151:18
    |
151 |         cx.spawn(async move |this, cx| {
    |                  ^^^^^-^^^^
    |                       |
    |                       help: missing `,`

Error writing files: failed to resolve mod `prompt`: cannot parse /Users/johnlindquist/dev/script-kit-gpui/src/prompts/chat/prompt.rs
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Adjusting rustfmt edition**
exec
/bin/zsh -lc 'rustfmt --edition 2021 src/prompts/chat/mod.rs src/prompts/chat/render_core.rs src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 51ms:

file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Rerunning build verification**
exec
/bin/zsh -lc 'cargo check -p script-kit-gpui' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 7.38s:
    Blocking waiting for file lock on build directory
    Checking script-kit-gpui v0.1.0 (/Users/johnlindquist/dev/script-kit-gpui)
warning: glob import doesn't reexport anything with visibility `pub(in crate::prompts)` because no imported item is public enough
  --> src/prompts/div/mod.rs:32:16
   |
32 | pub(super) use inline::*;
   |                ^^^^^^^^^
   |
note: the most public imported item is `pub(self)`
  --> src/prompts/div/mod.rs:32:16
   |
32 | pub(super) use inline::*;
   |                ^^^^^^^^^
   = help: reduce the glob import's visibility or increase visibility of imported items
   = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: glob import doesn't reexport anything with visibility `pub(in crate::prompts)` because no imported item is public enough
  --> src/prompts/div/mod.rs:34:16
   |
34 | pub(super) use render_html::*;
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Inspecting test failure diff**
exec
/bin/zsh -lc 'git diff -- src/prompts/chat/mod.rs src/prompts/chat/render_core.rs src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 50ms:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 7dd2dc3..2300516 100644
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@ use crate::components::prompt_footer::{PromptFooter, PromptFooterColors, PromptF
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,7 +49,8 @@ pub(crate) use tests::chat_tests;
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Planning test runs and finalizing claims**
codex
Implementation and compile verification are complete; I’m now releasing the claimed files and marking this agent done with a summary note of the verification results (including the pre-existing `cargo test` blockers).
exec
/bin/zsh -lc '~/.claude/bin/swarm.ts update --id codex-script-gen-render --status done --notes "added script generation action row + status rendering in chat footer area; cargo check -p script-kit-gpui passes; cargo test scoped blocked by existing unrelated test-module compile errors"' in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc '~/.claude/bin/swarm.ts release --id codex-script-gen-render src/prompts/chat/mod.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
Updated: codex-script-gen-render
 succeeded in 51ms:
Released for codex-script-gen-render: src/prompts/chat/mod.rs
exec
/bin/zsh -lc '~/.claude/bin/swarm.ts release --id codex-script-gen-render src/prompts/chat/tests.rs' in /Users/johnlindquist/dev/script-kit-gpuiexec
/bin/zsh -lc '~/.claude/bin/swarm.ts release --id codex-script-gen-render src/prompts/chat/render_core.rs' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 52ms:
Released for codex-script-gen-render: src/prompts/chat/tests.rs
 succeeded in 52ms:
Released for codex-script-gen-render: src/prompts/chat/render_core.rs
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Summarizing final deliverables and testing instructions**
exec
/bin/zsh -lc 'rg -n "render_script_generation_actions|chat-script-generation-status|should_show_script_generation_actions_only_when_draft_is_ready|script_generation_action_should_run_after_save_only_for_run_variants|AnyElement" src/prompts/chat/{render_core.rs,tests.rs,mod.rs} -n' in /Users/johnlindquist/dev/script-kit-gpui succeeded in 53ms:
src/prompts/chat/mod.rs:14:    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
src/prompts/chat/render_core.rs:28:    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
src/prompts/chat/render_core.rs:57:             -> AnyElement {
src/prompts/chat/render_core.rs:101:                    .id("chat-script-generation-status")
src/prompts/chat/render_core.rs:476:                self.render_script_generation_actions(cx),
src/prompts/chat/render_core.rs:477:                |d, actions: AnyElement| d.child(actions),
src/prompts/chat/tests.rs:158:    fn should_show_script_generation_actions_only_when_draft_is_ready() {
src/prompts/chat/tests.rs:178:    fn script_generation_action_should_run_after_save_only_for_run_variants() {
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]


thinking
**Planning final summary structure**
codex
Implemented the missing chat UI rendering for script-generation actions.

**What changed**
- Added `render_script_generation_actions` in `src/prompts/chat/render_core.rs:28`:
  - Shows `Save`, `Run`, and `Save and Run` buttons when `should_show_script_generation_actions()` is true.
  - Buttons call:
    - `handle_script_generation_action(ScriptGenerationAction::Save)`
    - `handle_script_generation_action(ScriptGenerationAction::Run)`
    - `handle_script_generation_action(ScriptGenerationAction::SaveAndRun)`
  - Shows `script_generation_status` text when present.
    - Error color: `theme.colors.ui.error` (red)
    - Success color: `theme.colors.ui.success` (green)
- Inserted this row into the main chat layout below messages and above the footer in `src/prompts/chat/render_core.rs:476`.
- Added `AnyElement` import needed for typed render composition in `src/prompts/chat/mod.rs:14`.
- Added focused logic tests in `src/prompts/chat/tests.rs`:
  - `should_show_script_generation_actions_only_when_draft_is_ready`
  - `script_generation_action_should_run_after_save_only_for_run_variants`

**Changed files**
- `src/prompts/chat/render_core.rs`
- `src/prompts/chat/mod.rs`
- `src/prompts/chat/tests.rs`

**Verification run**
- Passed: `cargo check -p script-kit-gpui`
- Attempted scoped test run, but blocked by pre-existing unrelated workspace test compilation issues (`E0761` duplicate module files, plus unrelated `actions` test compile failures), so `cargo test` is not currently runnable in this tree.

**How to test manually**
1. Open chat prompt in script-generation mode (`script_generation_mode=true`).
2. Generate a script response and wait for streaming to finish.
3. Confirm buttons appear below the last message: `Save`, `Run`, `Save and Run`.
4. Click each and confirm status text appears under buttons.
5. Confirm error statuses render red and success statuses render green.

**Risks / known gaps**
- No UI screenshot verification was run in this pass.
- Full/targeted `cargo test` remains blocked by unrelated existing test-tree issues.
file update:
diff --git a/src/prompts/chat/mod.rs b/src/prompts/chat/mod.rs
index 62192b6f95c7250cce9ab48d271e12ace5ee4647..23005163cc8222ccb0440cce690fca97363a63e2
--- a/src/prompts/chat/mod.rs
+++ b/src/prompts/chat/mod.rs
@@ -11,9 +11,9 @@
 use crate::components::TextInputState;
 use crate::designs::icon_variations::IconName;
 use gpui::{
-    div, img, list, prelude::*, px, rgb, rgba, svg, App, Context, ExternalPaths, FocusHandle,
-    Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState, Render,
-    RenderImage, ScrollWheelEvent, Timer, Window,
+    div, img, list, prelude::*, px, rgb, rgba, svg, AnyElement, App, Context, ExternalPaths,
+    FocusHandle, Focusable, Hsla, KeyDownEvent, ListAlignment, ListSizingBehavior, ListState,
+    Render, RenderImage, ScrollWheelEvent, Timer, Window,
 };
 use gpui_component::{scroll::ScrollableElement, theme::ActiveTheme};
 use std::collections::HashMap;
@@ -49,8 +49,8 @@
 use self::types::{
     build_conversation_turns, default_conversation_starters, next_chat_scroll_follow_state,
     next_reveal_boundary, resolve_chat_input_key_action, resolve_setup_card_key,
-    should_ignore_stream_reveal_update, should_show_script_generation_actions,
-    ChatInputKeyAction, ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
+    should_ignore_stream_reveal_update, should_show_script_generation_actions, ChatInputKeyAction,
+    ChatScrollDirection, ScriptGenerationAction, SetupCardAction,
 };
 
 pub use prompt::ChatPrompt;
diff --git a/src/prompts/chat/render_core.rs b/src/prompts/chat/render_core.rs
index e24f65941b1f6767b49a6a865fd68dd4cce3921b..0bfa40f59536d997d46db8e8ed6abefd449ca146
--- a/src/prompts/chat/render_core.rs
+++ b/src/prompts/chat/render_core.rs
@@ -24,6 +24,90 @@
         // handle the actual functionality via the parent's key handler.
         PromptFooter::new(footer_config, footer_colors)
     }
+
+    fn render_script_generation_actions(&self, cx: &mut Context<Self>) -> Option<AnyElement> {
+        let show_actions = self.should_show_script_generation_actions();
+        let status_message = self.script_generation_status.clone();
+
+        if !show_actions && status_message.is_none() {
+            return None;
+        }
+
+        let colors = &self.prompt_colors;
+        let theme_colors = &self.theme.colors;
+        let button_bg = theme::hover_overlay_bg(&self.theme, 0x24);
+        let button_hover_bg = theme::hover_overlay_bg(&self.theme, 0x36);
+
+        let mut action_container = div()
+            .id("chat-script-generation-actions")
+            .w_full()
+            .px(px(12.0))
+            .pt(px(8.0))
+            .pb(px(6.0))
+            .flex()
+            .flex_col()
+            .gap(px(6.0))
+            .border_t_1()
+            .border_color(rgba((colors.quote_border << 8) | 0x40));
+
+        if show_actions {
+            let button = |id: &'static str,
+                          label: &'static str,
+                          action: ScriptGenerationAction|
+             -> AnyElement {
+                div()
+                    .id(format!("chat-script-generation-{}", id))
+                    .px(px(10.0))
+                    .py(px(5.0))
+                    .rounded(px(6.0))
+                    .bg(button_bg)
+                    .cursor_pointer()
+                    .hover(move |d| d.bg(button_hover_bg))
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(colors.text_primary))
+                    .child(label)
+                    .on_click(cx.listener(move |this, _event, _window, cx| {
+                        this.handle_script_generation_action(action, cx);
+                    }))
+                    .into_any_element()
+            };
+
+            action_container = action_container.child(
+                div()
+                    .flex()
+                    .flex_row()
+                    .flex_wrap()
+                    .gap(px(8.0))
+                    .child(button("save", "Save", ScriptGenerationAction::Save))
+                    .child(button("run", "Run", ScriptGenerationAction::Run))
+                    .child(button(
+                        "save-and-run",
+                        "Save and Run",
+                        ScriptGenerationAction::SaveAndRun,
+                    )),
+            );
+        }
+
+        if let Some(status) = status_message {
+            let status_color = if self.script_generation_status_is_error {
+                theme_colors.ui.error
+            } else {
+                theme_colors.ui.success
+            };
+
+            action_container = action_container.child(
+                div()
+                    .id("chat-script-generation-status")
+                    .text_xs()
+                    .font_weight(gpui::FontWeight::MEDIUM)
+                    .text_color(rgb(status_color))
+                    .child(status),
+            );
+        }
+
+        Some(action_container.into_any_element())
+    }
 }
 
 impl Focusable for ChatPrompt {
@@ -387,6 +471,11 @@
             .child(input_area)
             // Scrollable message area
             .child(messages_content)
+            // Script generation save/run actions (shown for generated drafts when available)
+            .when_some(
+                self.render_script_generation_actions(cx),
+                |d, actions: AnyElement| d.child(actions),
+            )
             // Footer with model selector, Continue in Chat, and Actions
             .child(self.render_footer(cx))
             // Note: Actions menu is now handled by parent via on_show_actions callback
diff --git a/src/prompts/chat/tests.rs b/src/prompts/chat/tests.rs
index 83e3290bf5bbe11760dbf7d3eeb419db1fd04e32..154fc6bc544fb31ba9692734d0cdd132292bfe39
--- a/src/prompts/chat/tests.rs
+++ b/src/prompts/chat/tests.rs
@@ -8,8 +8,9 @@
 
     use super::{
         next_chat_scroll_follow_state, next_reveal_boundary, resolve_chat_input_key_action,
-        resolve_setup_card_key, should_ignore_stream_reveal_update, ChatInputKeyAction,
-        ChatScrollDirection, SetupCardAction,
+        resolve_setup_card_key, should_ignore_stream_reveal_update,
+        should_show_script_generation_actions, ChatInputKeyAction, ChatScrollDirection,
+        ScriptGenerationAction, SetupCardAction,
     };
 
     #[test]
@@ -153,6 +154,42 @@
         );
     }
 
+    #[test]
+    fn should_show_script_generation_actions_only_when_draft_is_ready() {
+        assert!(
+            should_show_script_generation_actions(true, false, true),
+            "Script actions should show only when generation mode is on, not streaming, and a draft exists"
+        );
+        assert!(
+            !should_show_script_generation_actions(false, false, true),
+            "Script actions should stay hidden when script generation mode is disabled"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, true, true),
+            "Script actions should stay hidden while streaming is in progress"
+        );
+        assert!(
+            !should_show_script_generation_actions(true, false, false),
+            "Script actions should stay hidden when there is no draft response yet"
+        );
+    }
+
+    #[test]
+    fn script_generation_action_should_run_after_save_only_for_run_variants() {
+        assert!(
+            !ScriptGenerationAction::Save.should_run_after_save(),
+            "Save should not run the script"
+        );
+        assert!(
+            ScriptGenerationAction::Run.should_run_after_save(),
+            "Run should run after saving"
+        );
+        assert!(
+            ScriptGenerationAction::SaveAndRun.should_run_after_save(),
+            "SaveAndRun should run after saving"
+        );
+    }
+
     // --- next_reveal_boundary tests ---
 
     #[test]

tokens used
181,546
Implemented the missing chat UI rendering for script-generation actions.

**What changed**
- Added `render_script_generation_actions` in `src/prompts/chat/render_core.rs:28`:
  - Shows `Save`, `Run`, and `Save and Run` buttons when `should_show_script_generation_actions()` is true.
  - Buttons call:
    - `handle_script_generation_action(ScriptGenerationAction::Save)`
    - `handle_script_generation_action(ScriptGenerationAction::Run)`
    - `handle_script_generation_action(ScriptGenerationAction::SaveAndRun)`
  - Shows `script_generation_status` text when present.
    - Error color: `theme.colors.ui.error` (red)
    - Success color: `theme.colors.ui.success` (green)
- Inserted this row into the main chat layout below messages and above the footer in `src/prompts/chat/render_core.rs:476`.
- Added `AnyElement` import needed for typed render composition in `src/prompts/chat/mod.rs:14`.
- Added focused logic tests in `src/prompts/chat/tests.rs`:
  - `should_show_script_generation_actions_only_when_draft_is_ready`
  - `script_generation_action_should_run_after_save_only_for_run_variants`

**Changed files**
- `src/prompts/chat/render_core.rs`
- `src/prompts/chat/mod.rs`
- `src/prompts/chat/tests.rs`

**Verification run**
- Passed: `cargo check -p script-kit-gpui`
- Attempted scoped test run, but blocked by pre-existing unrelated workspace test compilation issues (`E0761` duplicate module files, plus unrelated `actions` test compile failures), so `cargo test` is not currently runnable in this tree.

**How to test manually**
1. Open chat prompt in script-generation mode (`script_generation_mode=true`).
2. Generate a script response and wait for streaming to finish.
3. Confirm buttons appear below the last message: `Save`, `Run`, `Save and Run`.
4. Click each and confirm status text appears under buttons.
5. Confirm error statuses render red and success statuses render green.

**Risks / known gaps**
- No UI screenshot verification was run in this pass.
- Full/targeted `cargo test` remains blocked by unrelated existing test-tree issues.


==== exit @ 2026-02-08T03:41:46.058Z code=0 status=done ====
