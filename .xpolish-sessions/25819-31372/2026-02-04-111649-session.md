# xpolish session — 2026-02-04 (render_script_list token extraction)

## Commit
`ac62c4c` `[xpolish] refactor: extract remaining hardcoded values to named design tokens in render_script_list`

## Files changed
- `src/list_item.rs` — added 25 new `pub(crate)` constants for empty state, header area, divider, scroll; made `ALPHA_READABLE`, `FONT_SYSTEM_UI`, `FONT_MONO` public
- `src/render_script_list.rs` — replaced ~28 hardcoded opacity hex values, spacing px(), font family strings with named tokens
- `src/main.rs` — expanded `use list_item::{...}` import to include all new constants
- `src/components/unified_list_item/render.rs` — replaced `".AppleSystemUIFont"` with `crate::list_item::FONT_SYSTEM_UI`
- `src/designs/apple_hig.rs` — replaced `"SF Mono"` with `crate::list_item::FONT_MONO`

## Constants added (grouped)

| Group | Constants |
|-------|-----------|
| Empty state layout | `EMPTY_STATE_GAP` (12px), `EMPTY_STATE_ICON_SIZE` (32px), `EMPTY_STATE_MESSAGE_FONT_SIZE` (14px), `EMPTY_STATE_TIPS_MARGIN_TOP` (8px) |
| Empty state opacity | `ALPHA_EMPTY_ICON` (22%), `ALPHA_EMPTY_MESSAGE` (38%), `ALPHA_EMPTY_HINT` (27%), `ALPHA_EMPTY_TIPS` (17%) |
| Header area layout | `ASK_AI_BUTTON_GAP/PADDING_X/PADDING_Y/RADIUS`, `TAB_BADGE_PADDING_X/PADDING_Y/RADIUS` |
| Header area opacity | `ALPHA_HOVER_ACCENT` (15%), `ALPHA_TAB_BADGE_BG` (30%), `ALPHA_COUNT_HINT` (65%) |
| Divider & scroll | `DIVIDER_MARGIN_DEFAULT` (16px), `ALPHA_DIVIDER` (50%), `ESTIMATED_LIST_CONTAINER_HEIGHT` (440px), `AVERAGE_ITEM_HEIGHT_FOR_SCROLL` (44px) |

## What improved
- **Maintainability**: Zero remaining hardcoded magic numbers in render_script_list.rs — all 28 inline values now reference named constants with doc comments
- **Font consistency**: "SF Mono" and ".AppleSystemUIFont" strings consolidated to `FONT_MONO` and `FONT_SYSTEM_UI` tokens used across 5 files
- **Empty state contrast**: Icon opacity bumped 19%→22%, message text 31%→38%, hint text 21%→27%, tips 15%→17% — all improved for readability on vibrancy backgrounds
- **Count hint legibility**: Library size count opacity bumped 62%→65% to match `ALPHA_HINT` scale

## Screenshots
- Before: `.test-screenshots/xpolish2-before/01-initial-menu.png`, `02-with-selection.png`, `03-filtered.png`
- After: `.test-screenshots/xpolish2-after/01-initial-menu.png`, `02-with-selection.png`, `03-filtered.png`, `04-empty-state.png`

## What to avoid repeating
- **`include!()` scope**: `render_script_list.rs` is `include!()`'d into `main.rs`, so new constants must be imported in the `use list_item::{...}` block in `main.rs` — they don't resolve automatically
- **Visibility**: Constants used from `render_script_list.rs` (via `main.rs`) need `pub(crate)` not `const` — the include expands inside `impl ScriptListApp` which is in a different module boundary
- **Pre-existing clippy failures**: `--all-targets` triggers 47 pre-existing errors in test validation files; use `cargo clippy --` without `--all-targets`
- **Pre-existing test SIGKILL**: `cargo test` may SIGKILL on terminal spawn tests — not related to UI changes
