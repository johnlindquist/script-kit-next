# xpolish session — 2026-02-04

## Commit
`56cf4fc` `[xpolish] refactor: extract hardcoded values to named design tokens in list_item`

## Files changed
- `src/list_item.rs` — extracted ~50 magic numbers to named constants (typography, spacing, opacity, icons, badges, section headers, font families)
- `src/render_script_list.rs` — replaced hardcoded `28.0`/`32.0` with `SECTION_HEADER_HEIGHT` constant
- `src/theme/types.rs` — aligned serde default opacity functions with `dark_default()` values (selected: 0.12, hover: 0.07)

## What improved
- **Maintainability**: All hardcoded `px()` values, hex opacity bytes (`0xD9`, `0xCC`, etc.), and font family strings now have semantic names with doc comments explaining their intent
- **Contrast**: Description text opacity bumped from 80% (`ALPHA_READABLE`) to 85% (`ALPHA_STRONG`) for better readability on vibrancy backgrounds
- **Consistency**: `SECTION_HEADER_HEIGHT` used everywhere instead of inconsistent inline values (28.0 vs 32.0)
- **Opacity alignment**: Serde deserialization defaults now match `dark_default()` (0.12/0.07) — previously diverged (0.14/0.09)

## Constants added (grouped)
| Group | Constants |
|-------|-----------|
| Layout | `ITEM_PADDING_X/Y`, `ITEM_CONTAINER_PADDING_R`, `ITEM_ICON_TEXT_GAP`, `ITEM_NAME_DESC_GAP`, `ITEM_ACCESSORIES_GAP` |
| Icons | `ICON_CONTAINER_SIZE`, `ICON_SVG_SIZE` |
| Typography | `NAME_FONT_SIZE/LINE_HEIGHT`, `DESC_FONT_SIZE/LINE_HEIGHT`, `BADGE_FONT_SIZE`, `TOOL_BADGE_FONT_SIZE`, `SOURCE_HINT_FONT_SIZE`, `TYPE_TAG_FONT_SIZE`, `SECTION_HEADER_FONT_SIZE`, `SECTION_HEADER_ICON_SIZE` |
| Badges | `BADGE_PADDING_X/Y`, `BADGE_RADIUS`, `TOOL_BADGE_PADDING_X/Y`, `TOOL_BADGE_RADIUS`, `TYPE_TAG_PADDING_X/Y`, `TYPE_TAG_RADIUS` |
| Section headers | `SECTION_PADDING_X`, `SECTION_PADDING_TOP/BOTTOM`, `SECTION_GAP` |
| Opacity | `ALPHA_STRONG` (85%), `ALPHA_READABLE` (80%), `ALPHA_MUTED` (70%), `ALPHA_HINT` (65%), `ALPHA_SUBTLE` (60%), `ALPHA_BORDER` (25%), `ALPHA_SEPARATOR_STRONG` (15%), `ALPHA_SEPARATOR` (10%), `ALPHA_TINT_MEDIUM` (6%), `ALPHA_TINT_LIGHT` (5%), `ALPHA_TINT_FAINT` (4%) |
| Fonts | `FONT_SYSTEM_UI`, `FONT_MONO` |

## Screenshots
- Before: `.test-screenshots/xpolish-before/01-initial-menu.png`, `02-with-selection.png`, `03-filtered.png`
- After: `.test-screenshots/xpolish-after/01-initial-menu.png`, `02-with-selection.png`, `03-filtered.png`

## What to avoid repeating
- **File lock conflicts**: The file was modified externally during editing, causing stale-read errors. Always re-read before editing if significant time has passed.
- **Pre-commit formatting**: `cargo fmt` must be run on ALL project files, not just the changed ones — the hook checks everything.
- **Serde defaults vs constructor defaults**: `default_*_opacity()` functions (used by serde) and `dark_default()` (used by code) must stay in sync.
- **Clippy `--all-targets`**: Pre-existing test file issues cause failures. Use `cargo clippy --` (without `--all-targets`) for the main binary check.
