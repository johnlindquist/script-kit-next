# xpolish Session — 2026-02-04 11:29:18

## Commit
`b9d2678` — `[xpolish] refactor: boost contrast tokens, unify font references, fix builtins`

## Scope
Main menu list contrast, opacity tokens, font unification, and pre-existing compile error fix.

## Changes (8 files, +113 −46)

### Contrast / Opacity Improvements
| File | Token | Old | New | Δ |
|------|-------|-----|-----|---|
| list_item.rs | ALPHA_MUTED | 0xB3 (70%) | 0xBF (75%) | +5pp |
| list_item.rs | ALPHA_HINT | 0xA6 (65%) | 0xB3 (70%) | +5pp |
| list_item.rs | ALPHA_SUBTLE | 0x99 (60%) | 0xA6 (65%) | +5pp |
| list_item.rs | ALPHA_BORDER | 0x40 (25%) | 0x4D (30%) | +5pp |
| list_item.rs | ALPHA_SEPARATOR_STRONG | 0x26 (15%) | 0x2E (18%) | +3pp |
| list_item.rs | ALPHA_SEPARATOR | 0x1A (10%) | 0x1F (12%) | +2pp |
| list_item.rs | ALPHA_TINT_MEDIUM | 0x0F (6%) | 0x12 (7%) | +1pp |
| list_item.rs | ALPHA_TINT_LIGHT | 0x0D (5%) | 0x0F (6%) | +1pp |
| list_item.rs | ALPHA_TINT_FAINT | 0x0A (4%) | 0x0D (5%) | +1pp |
| list_item.rs | ALPHA_EMPTY_ICON | 0x38 (22%) | 0x47 (28%) | +6pp |
| list_item.rs | ALPHA_EMPTY_MESSAGE | 0x60 (38%) | 0x73 (45%) | +7pp |
| list_item.rs | ALPHA_EMPTY_HINT | 0x45 (27%) | 0x54 (33%) | +6pp |
| list_item.rs | ALPHA_EMPTY_TIPS | 0x2B (17%) | 0x38 (22%) | +5pp |
| theme/types.rs | selected_opacity (dark) | 0.12 | 0.15 | +3pp |
| theme/types.rs | hover_opacity (dark) | 0.07 | 0.09 | +2pp |

### New Named Constants
| File | Constant | Value | Replaces |
|------|----------|-------|----------|
| list_item.rs | DIVIDER_BORDER_WIDTH_DEFAULT | 1.0 | hardcoded `1.0` in render_script_list.rs:1137 |
| list_item.rs | LOG_PANEL_MAX_HEIGHT | 120.0 | hardcoded `px(120.)` in render_script_list.rs:480 |

### Font Unification
- `button.rs`: `.font_family(".AppleSystemUIFont")` → `.font_family(crate::list_item::FONT_SYSTEM_UI)`
- `prompt_container.rs`: same replacement

### Pre-existing Compile Error Fix (render_builtins.rs)
Added 4 missing items on `ScriptListApp` that were referenced but never defined:
- `VIBRANCY_MATERIALS` — const array of `(VibrancyMaterial, &str)` tuples (5 materials)
- `FONT_SIZE_PRESETS` — const array of `(f32, &str)` tuples (7 sizes: 12–20)
- `find_vibrancy_material_index()` — lookup helper for cycling vibrancy materials
- `accent_color_name()` — hex→name mapping for accent color display
- Fixed clippy `field_reassign_with_default` in font size preset handler

### Test Updates
- `theme_tests.rs`: Updated `test_opacity_defaults` to match new selected/hover values

## Verification
- `cargo check` ✅
- `cargo clippy -- -D warnings` ✅
- `cargo test` ✅ (9,567 passed, 0 failed)
- `cargo fmt` ✅
- Pre-commit hook (anti-slop bot) ✅ APPROVED

## Rationale
All opacity bumps are modest (~5 percentage points) to improve text legibility on macOS
vibrancy backgrounds without making the UI feel heavy. The selection/hover opacity bumps
provide clearer visual feedback for keyboard and mouse navigation. Font unification
eliminates redundant hardcoded strings. The render_builtins fix restores the build to
a compilable state (HEAD was broken before this commit).
