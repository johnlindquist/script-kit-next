# Session: Improve AI Chat UX (Tables, Task Lists, Rich Lists, Delete Confirmation)

## Files Changed
- `src/prompts/markdown.rs` — table rendering, task list checkboxes, rich list items with inline formatting, ListItem struct, TableState parser
- `src/ai/window.rs` — sidebar message count badges, two-step chat delete confirmation, message_counts HashMap

## What Was Improved
1. **Markdown table rendering** — Tables are now properly parsed and rendered as bordered grids with semibold header rows, alternating row backgrounds, and inline-formatted cell content. Previously tables were silently dropped despite parser support.
2. **Task list checkboxes** — `- [x]` and `- [ ]` syntax now renders as visual ☑/☐ indicators. Checked items show muted text color. Uses `ListItem` struct with `checked: Option<bool>` field.
3. **Rich list items** — List items now preserve bold, italic, code, links, and strikethrough formatting via `render_inline_spans`. Previously all inline formatting was stripped to plain text concatenation.
4. **Sidebar message count** — Each chat item shows a subtle "N msgs" badge alongside the model badge, helping users identify substantial conversations at a glance.
5. **Two-step delete confirmation** — Chat deletion now requires confirmation: first click shows a red "Delete?" label, second click actually deletes. Prevents accidental data loss. Confirmation resets when selecting a different chat.

## What to Avoid Repeating
- Pre-existing test failures in `dialog_builtin_action_validation_tests_39` — use `cargo test --lib prompts::markdown` or `cargo clippy --lib` to verify changes
- When adding new `ParsedBlock` variants, must update both `parse_markdown` (main parser) and `parse_markdown_blocks` (test parser) since they mirror each other
- `ListState.items` changed from `Vec<Vec<InlineSpan>>` to `Vec<ListItem>` — all code pushing to `list.items` must use `ListItem { spans, checked }` struct
- `render_inline_spans` returns a `Div`, not `AnyElement` — use `.into_any_element()` when branching between different element types (e.g., checked vs unchecked)
- Table cell rendering in test parser stores spans differently than main parser — test uses simplified single-span cells while main parser preserves full inline formatting
