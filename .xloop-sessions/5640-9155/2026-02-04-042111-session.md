# Session: Batch 23 Builtin Action Validation Tests

**Date**: 2026-02-04
**Commit**: 323246f
**Branch**: main

## Summary

Created batch 23 of dialog builtin action validation tests with **131 tests** across **30 categories**, continuing the series from batches 1-22.

## Files Changed

- `src/actions/dialog_builtin_action_validation_tests_23.rs` (new, ~1619 lines) — 131 tests in 30 categories
- `src/actions/mod.rs` (+4 lines: test module registration for batch 23)

## What Was Improved

### New Tests (131 across 30 categories):

1. **Script context: action_verb propagation in run_script title** — 5 tests: default "Run", "Launch", "Switch to", "Open", description uses verb
2. **Script context: action count varies by type flags** — 5 tests: full script=9, builtin=4, scriptlet=8, with shortcut=10, with shortcut+alias=11
3. **Clipboard context: exact action ordering** — 4 tests: first three paste/copy/paste_keep_open, share+attach after, destructive at end, save before delete
4. **Clipboard context: attach_to_ai shortcut** — 3 tests: shortcut ⌃⌘A, description mentions AI, present for image
5. **Path context: exact action IDs in order for directory** — 3 tests: dir 7 IDs in order, file 7 IDs in order, always 7 actions
6. **Path context: open_in_editor description mentions $EDITOR** — 3 tests: editor desc, terminal desc, copy_path shortcut ⌘⇧C
7. **File context: shortcut matrix** — 4 tests: open=↵, reveal=⌘↵, copy_path=⌘⇧C, copy_filename=⌘C
8. **File context: title includes quoted file name** — 4 tests: file title quotes name, dir title quotes name, dir desc says folder, file desc says application
9. **AI command bar: action shortcut presence/absence matrix** — 5 tests: copy_response=⇧⌘C, copy_chat=⌥⇧⌘C, copy_last_code=⌥⌘C, branch_from_last none, change_model none
10. **AI command bar: description content validation** — 5 tests: submit/send, new_chat/new, delete_chat/delete, export/markdown, paste_image/clipboard
11. **Chat context: model IDs use select_model_ prefix** — 4 tests: prefix format, sequential IDs, description "via {provider}", current model checkmark ✓
12. **Chat context: continue_in_chat is always present** — 3 tests: always present, shortcut ⌘↵, after models
13. **Notes command bar: section icon assignments** — 5 tests: new_note=Plus, browse=FolderOpen, find=MagnifyingGlass, format=Code, auto_sizing=Settings
14. **Notes command bar: shortcut assignments** — 4 tests: new_note=⌘N, browse=⌘P, duplicate=⌘D, format=⇧⌘T
15. **New chat actions: empty inputs produce empty output** — 5 tests: all empty, only last_used, only presets, only models, mixed count=3
16. **New chat actions: icon assignments** — 4 tests: last_used=BoltFilled, model=Settings, preset icon preserved, preset no description
17. **Note switcher: empty list produces placeholder** — 5 tests: id=no_notes, title="No notes yet", icon=Plus, section=Notes, description mentions ⌘N
18. **Note switcher: multi-note section assignment** — 3 tests: pinned+recent sections, all pinned, all recent
19. **Note switcher: id format uses note_{uuid}** — 2 tests: id format, multiple IDs unique
20. **Scriptlet defined actions: has_action and value** — 4 tests: has_action=true, value=command, id prefix scriptlet_action:, shortcut formatted
21. **Scriptlet context with custom: ordering of custom vs built-in** — 2 tests: custom between run and shortcut, multiple custom preserve order
22. **to_deeplink_name: whitespace and mixed input** — 5 tests: tabs/newlines, multiple spaces, leading/trailing specials, mixed alpha/numeric/special, Unicode preserved
23. **format_shortcut_hint: modifier ordering** — 5 tests: cmd+c=⌘C, ctrl+shift+delete=⌃⇧⌫, alt+enter=⌥↵, meta=⌘, super=⌘
24. **parse_shortcut_keycaps: multi-char and edge cases** — 5 tests: ⌘↵, single letter A, arrows, all modifiers, lowercase uppercased
25. **score_action: fuzzy vs prefix vs contains** — 5 tests: prefix highest, contains medium, fuzzy low, no match zero, empty=prefix
26. **fuzzy_match: edge cases** — 5 tests: exact, subsequence, no match, empty needle, needle longer fails
27. **build_grouped_items_static: headers style adds section labels** — 4 tests: two sections=4 items, same section no dup=3, separators no headers=2, empty filtered
28. **coerce_action_selection: various scenarios** — 5 tests: empty=None, item stays, header skips to item, header at end searches up, all headers=None
29. **Action builder: has_action defaults to false** — 5 tests: has_action false, value none, icon none, section none, full builder chain preserves all
30. **Cross-context: all contexts produce at least one action** — 10 tests: script, builtin, clipboard text, clipboard image, path, file, AI, notes, chat, note switcher

## Verification

- `cargo check --lib` pass
- `cargo clippy --lib -- -D warnings` pass
- `cargo test --lib actions::dialog_builtin_action_validation_tests_23` 131 passed, 0 failed
- `git push` pass

## What to Avoid Repeating

- **Pre-existing bin compilation errors** in `ai/window.rs` from concurrent agents. Use `cargo check --lib` / `cargo clippy --lib` to avoid.
- **`cargo fmt` in pre-commit hook formats ALL modified files**: Run `cargo fmt` before committing.
- **Action count depends on type flags**: script=9, builtin=4, scriptlet=8, with shortcut adds +1, with alias adds +1.
- **Path context always has exactly 7 actions** regardless of is_dir — the primary action ID changes but count stays the same.
- **Clipboard attach_to_ai shortcut is ⌃⌘A** (Control+Cmd+A), not ⌘A.
- **File context open shortcut is ↵**, reveal is ⌘↵ — note the modifier difference.
- **AI command bar branch_from_last and change_model have NO shortcuts** — they are purely menu actions.
- **Chat model IDs use `select_model_{model_id}` format** — the model_id is used directly, not an index.
- **Note switcher placeholder has id="no_notes"** and description mentions ⌘N for creating a new note.
- **Scriptlet defined actions always have `has_action=true`** and value set to the command field.
- **`to_deeplink_name` converts tabs and newlines to hyphens** along with other whitespace.
