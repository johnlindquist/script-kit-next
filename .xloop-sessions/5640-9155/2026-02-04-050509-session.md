# Session: Batch 29 Builtin Action Validation Tests

**Date**: 2026-02-04
**Commit**: 71654ba
**Branch**: main

## Summary

Created batch 29 of dialog builtin action validation tests with **115 tests** across **30 categories**, continuing the series from batches 1-28.

## Files Changed

- `src/actions/dialog_builtin_action_validation_tests_29.rs` (new, ~1335 lines) — 115 tests in 30 categories
- `src/actions/mod.rs` (+4 lines: test module registration for batch 29)

## What Was Improved

### New Tests (115 across 30 categories):

1. **Note switcher — empty notes produces helpful placeholder action** — 5 tests: single action, id="no_notes", title="No notes yet", desc mentions ⌘N, icon=Plus
2. **Note switcher — section is "Notes" for placeholder, else Pinned/Recent** — 3 tests: placeholder=Notes, pinned=Pinned, unpinned=Recent
3. **Note switcher — note ID format is "note_{uuid}"** — 2 tests: full UUID format, starts_with "note_"
4. **Clipboard — text entry action count on macOS vs all platforms** — 2 tests: text=12 (macOS), image=16 (macOS)
5. **Clipboard — attach_to_ai shortcut and section** — 3 tests: shortcut ⌃⌘A, title "Attach to AI Chat", desc mentions AI
6. **Clipboard — share action present for both text and image** — 3 tests: text has share, image has share, same shortcut for both
7. **Script context — with_all constructor preserves every field** — 4 tests: name, action_verb, is_script, run title uses verb+name
8. **Script context — agent has edit_script with "Agent" title but no view_logs** — 4 tests: title "Edit Agent", no view_logs, has copy_content, has reveal_in_finder
9. **Notes command bar — format action details** — 4 tests: shortcut ⇧⌘T, icon Code, section Edit, absent without selection
10. **Notes command bar — new_note always present with correct details** — 4 tests: present in full mode, present in trash, shortcut ⌘N, icon Plus
11. **AI command bar — copy_chat details** — 4 tests: shortcut ⌥⇧⌘C, icon Copy, section Response, desc mentions conversation
12. **AI command bar — copy_last_code details** — 4 tests: shortcut ⌥⌘C, icon Code, section Response, desc mentions code
13. **AI command bar — copy_response in command bar vs chat context** — 3 tests: AI shortcut ⇧⌘C, chat shortcut ⌘C, different shortcuts
14. **Chat context — model ID format is "select_model_{id}"** — 3 tests: ID format, title=display_name, description="via {provider}"
15. **File context — open_file title format** — 4 tests: file quotes name, dir quotes name, file desc says default application, dir desc says folder
16. **Path context — select_file vs open_directory description wording** — 4 tests: select says submit, open says navigate, file has no open_directory, dir has no select_file
17. **to_deeplink_name — preserves numbers and lowercase letters** — 4 tests: lowercase, numbers, mixed case lowered, spaces to hyphens
18. **format_shortcut_hint — combined modifier+key combos** — 5 tests: cmd+shift+k, ctrl+alt+delete, meta alias, option+space, single enter
19. **parse_shortcut_keycaps — multi-symbol shortcut strings** — 4 tests: ⌘↵, all modifiers+key, ␣, arrows
20. **score_action — description bonus adds to prefix score** — 3 tests: prefix+desc=115+, prefix+shortcut=110+, all three bonuses
21. **fuzzy_match — case sensitivity and edge cases** — 5 tests: exact, subsequence, no match, empty needle, needle longer
22. **build_grouped_items_static — section headers with Headers style** — 4 tests: headers adds headers, separators no headers, same section one header, empty returns empty
23. **coerce_action_selection — header skipping behavior** — 5 tests: on item stays, header jumps down, trailing header jumps up, all headers None, empty None
24. **CommandBarConfig — all presets preserve close defaults** — 4 tests: ai close_on_select, main_menu close_on_escape, no_search close_on_click_outside, notes all true
25. **CommandBarConfig — show_icons and show_footer combinations** — 4 tests: ai has both, main_menu neither, notes has both, no_search neither
26. **New chat — empty inputs produce empty actions** — 4 tests: all empty, only last_used=1, only presets=1, only models=1
27. **Scriptlet context with_custom — reset_ranking is always last** — 3 tests: scriptlet, script, builtin all have reset_ranking last when suggested
28. **Cross-context — all built-in actions have ActionCategory::ScriptContext** — 4 tests: script, clipboard, AI, path
29. **Cross-context — first action ID is always the primary action** — 5 tests: script=run_script, clipboard=clipboard_paste, path file=select_file, path dir=open_directory, file=open_file
30. **Action builder — chaining preserves all fields correctly** — 5 tests: defaults, full chain, title_lower, description_lower, shortcut_lower

## Verification

- `cargo check --lib` pass
- `cargo clippy --lib -- -D warnings` pass
- `cargo test --lib actions::dialog_builtin_action_validation_tests_29` 115 passed, 0 failed
- `git push` pass

## What to Avoid Repeating

- **Clipboard image action count on macOS is 16, not 17** — the previous estimate of macOS image actions was off by one.
- **AI command bar `copy_response` shortcut is ⇧⌘C**, while chat context `copy_response` shortcut is ⌘C — they differ.
- **AI command bar `copy_chat` shortcut is ⌥⇧⌘C** (4 modifiers) — the most complex shortcut in the system.
- **AI command bar `copy_last_code` shortcut is ⌥⌘C**, icon is Code, section is Response.
- **Note switcher with zero notes produces a single placeholder** action with id="no_notes", title="No notes yet", icon=Plus, section="Notes".
- **Note switcher note IDs use `note_{uuid}` format** — the UUID comes from the NoteSwitcherNoteInfo.id field.
- **Notes format action (id="format") has shortcut ⇧⌘T, icon Code, section Edit** — only present when has_selection=true.
- **Path context is mutually exclusive**: files get select_file but not open_directory; dirs get open_directory but not select_file.
- **`get_new_chat_actions` with all empty inputs returns empty Vec** — no placeholder or default actions.
- **Pre-existing bin compilation errors** in `ai/window.rs` from concurrent agents. Use `cargo check --lib` / `cargo clippy --lib` to avoid.
- **`cargo fmt` in pre-commit hook formats ALL modified files**: Run `cargo fmt` before committing.
