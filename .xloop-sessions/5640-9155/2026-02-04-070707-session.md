# Session: Batch 42 Builtin Action Validation Tests

**Date**: 2026-02-04
**Commit**: 2a9329f
**Branch**: main

## Summary

Created batch 42 of dialog builtin action validation tests with **120 tests** across **30 categories**, continuing the series from batches 1-41.

## Files Changed

- `src/actions/dialog_builtin_action_validation_tests_42.rs` (new, ~1522 lines) — 120 tests in 30 categories
- `src/actions/mod.rs` (+4 lines: test module registration for batch 42)

## What Was Improved

### New Tests (120 across 30 categories):

1. **Action cached lowercase fields: title_lower pre-computed** — 4 tests: lowercase of title, mixed case, description_lower present, None when no desc
2. **Action::with_shortcut sets shortcut_lower correctly** — 4 tests: sets shortcut_lower, preserves original, None by default, arrow symbols unchanged
3. **Clipboard: quick_look shortcut is ␣ on macOS** — 4 tests: shortcut ␣, title "Quick Look", desc mentions Quick Look, present for text and image
4. **Clipboard: clipboard_delete shortcut is ⌃X** — 4 tests: shortcut ⌃X, title "Delete Entry", desc mentions "Remove", present for image
5. **Clipboard: context_title byte-based truncation boundary** — 4 tests: short not truncated, exactly 30 not truncated, 31 truncated, long at byte 27
6. **File context: open_file title quotes filename** — 4 tests: file quotes name, dir quotes name, file desc mentions default application, dir desc mentions folder
7. **File context: reveal_in_finder desc and title** — 4 tests: desc mentions "Reveal", title "Show in Finder", shortcut ⌘↵, present for dirs
8. **Path context: copy_path vs copy_filename shortcut differences** — 4 tests: copy_path ⌘⇧C, copy_filename no shortcut, open_in_finder ⌘⇧F, path vs file use different IDs
9. **Script context: copy_content shortcut ⌘⌥C across all types** — 4 tests: script, scriptlet, agent, scriptlet with_custom
10. **Script context: view_logs only for is_script=true** — 4 tests: script has it, scriptlet no, builtin no, agent no
11. **Scriptlet with_custom: shortcut/alias dynamic match** — 4 tests: no shortcut→add, has shortcut→update+remove, no alias→add, has alias→update+remove
12. **Scriptlet context: copy_content desc** — 4 tests: scriptlet, with_custom, script, agent all say "entire file content"
13. **AI bar: copy_response vs copy_chat vs copy_last_code shortcuts** — 4 tests: ⇧⌘C, ⌥⇧⌘C, ⌥⌘C, all three differ
14. **AI bar: branch_from_last has NO shortcut** — 4 tests: no shortcut, icon ArrowRight, section Actions, desc mentions branch
15. **AI bar: sections have correct action counts** — 4 tests: Response=3, Actions=4, Attachments=2, Settings=1
16. **Notes: new_note always present even in trash** — 4 tests: present no selection, present in trash, shortcut ⌘N, icon Plus
17. **Notes: enable_auto_sizing only when disabled** — 4 tests: disabled shows enable, enabled hides, shortcut ⌘A, icon Settings
18. **Chat context: continue_in_chat shortcut ⌘↵** — 4 tests: shortcut, title, desc mentions AI Chat, always present
19. **Chat context: clear_conversation shortcut ⌘⌫** — 4 tests: shortcut, title, absent when no messages, desc mentions clear
20. **New chat: preset icon preserved** — 4 tests: icon preserved, different icons, name is title, description None
21. **New chat: models description uses provider_display_name** — 4 tests: desc is provider, title is display_name, icon Settings, section Models
22. **Note switcher: unpinned non-current icon is File** — 4 tests: unpinned=File, pinned=StarFilled, current=Check, pinned+current=StarFilled
23. **Note switcher: note ID format "note_{uuid}"** — 4 tests: format, prefix, distinct IDs, section pinned vs recent
24. **to_deeplink_name: empty string** — 4 tests: empty→empty, all special→empty, single word, preserves numbers
25. **to_deeplink_name: mixed unicode and ASCII** — 4 tests: spaces+underscores→hyphens, leading/trailing trimmed, consecutive collapse, uppercase lowercased
26. **Dialog format_shortcut_hint: enter/escape** — 4 tests: enter→↵, return→↵, escape→⎋, esc→⎋
27. **Dialog format_shortcut_hint: tab/backspace** — 4 tests: tab→⇥, backspace→⌫, delete→⌫, space→␣
28. **Dialog format_shortcut_hint: compound combos** — 4 tests: cmd+enter→⌘↵, ctrl+shift+backspace→⌃⇧⌫, alt+tab→⌥⇥, meta→⌘
29. **coerce_action_selection: header/item navigation** — 4 tests: header first→next item, item first stays, all headers→None, empty→None
30. **build_grouped_items_static: Headers vs Separators** — 4 tests: Headers inserts headers, Separators no headers, same section 1 header, empty filtered→empty

## Verification

- `cargo check --lib` pass
- `cargo clippy --lib -- -D warnings` pass
- `RUST_MIN_STACK=67108864 cargo test --lib actions::dialog_builtin_action_validation_tests_42` 120 passed, 0 failed
- `git push` pass

## What to Avoid Repeating

- **Action::new pre-computes `title_lower` and `description_lower`** — these are cached lowercase versions for fast filtering in `score_action()`.
- **Action::with_shortcut sets both `shortcut` (original) and `shortcut_lower` (lowercase)**. Unicode symbols like ↵ are unchanged by lowercase.
- **Clipboard `quick_look` is macOS-only** with shortcut `␣` (space symbol). Present for both text and image entries.
- **Clipboard `clipboard_delete` shortcut is `⌃X`** (Ctrl+X), NOT `⌘⌫`.
- **Context title truncation is byte-based**: `preview.len() > 30` checks bytes, `&preview[..27]` slices bytes. For ASCII this works fine.
- **File context uses `reveal_in_finder` ID**, while Path context uses `open_in_finder` ID — these are different action IDs despite similar functionality.
- **`copy_content` shortcut `⌘⌥C` is consistent** across script, scriptlet, agent, and scriptlet with_custom contexts.
- **`view_logs` is only available when `is_script=true`** — not for scriptlets, builtins, or agents.
- **AI bar has 3 different copy shortcuts**: `copy_response` (⇧⌘C), `copy_chat` (⌥⇧⌘C), `copy_last_code` (⌥⌘C).
- **AI bar `branch_from_last` has no shortcut** — it's the only action in the Actions section without one.
- **AI bar section counts**: Response=3, Actions=4, Attachments=2, Settings=1, Export=1, Help=1 (total 12).
- **Notes `enable_auto_sizing` only appears when `auto_sizing_enabled=false`**. Shortcut ⌘A, icon Settings.
- **Note switcher icon priority**: pinned (StarFilled) > current (Check) > default (File).
- **`to_deeplink_name("")` returns `""`** — empty input produces empty output, not a hyphen or other fallback.
