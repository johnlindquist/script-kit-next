# Session: Batch 35 Builtin Action Validation Tests

**Date**: 2026-02-04
**Commit**: 6ce4ffc
**Branch**: main

## Summary

Created batch 35 of dialog builtin action validation tests with **124 tests** across **30 categories**, continuing the series from batches 1-34.

## Files Changed

- `src/actions/dialog_builtin_action_validation_tests_35.rs` (new, ~1508 lines) — 124 tests in 30 categories
- `src/actions/mod.rs` (+4 lines: test module registration for batch 35)

## What Was Improved

### New Tests (124 across 30 categories):

1. **Clipboard: attach_to_ai shortcut and description** — 4 tests: shortcut ⌃⌘A, title "Attach to AI Chat", desc mentions AI, present for image
2. **Clipboard: total action count text vs image on macOS** — 4 tests: text=12, image=16, image has 4 more, pinned vs unpinned same count
3. **File context: primary action title is quoted with name** — 4 tests: file="Open \"readme.md\"", dir="Open \"Documents\"", file shortcut ↵, dir shortcut ↵
4. **Path context: primary action description varies** — 4 tests: file desc "Submit", dir desc "Navigate", file id=select_file, dir id=open_directory
5. **Script context: edit shortcut ⌘E across types** — 4 tests: script ⌘E, scriptlet ⌘E, agent ⌘E, copy_content ⌘⌥C
6. **Scriptlet custom H3 actions: ID prefix, has_action, value** — 4 tests: id="scriptlet_action:command", has_action=true, value=command, builtins has_action=false
7. **Scriptlet custom action with shortcut formatting** — 5 tests: cmd+shift+x→⌘⇧X, no shortcut=None, description propagated, title=name, separate test for each
8. **AI command bar: copy_chat and copy_last_code** — 6 tests: copy_chat ⌥⇧⌘C/Copy/Response, copy_last_code ⌥⌘C/Code/Response
9. **AI command bar: all IDs unique** — 4 tests: unique IDs, all have icon, all have section, count=12
10. **Chat context: select_model ID format** — 4 tests: id="select_model_{model_id}", current has ✓, non-current no ✓, desc "via {provider}"
11. **Notes command bar: format action details** — 4 tests: shortcut ⇧⌘T, icon Code, section Edit, absent in trash
12. **Notes trash view exact action set** — 4 tests: exactly 3 actions, has new_note, has browse_notes, has enable_auto_sizing
13. **Note switcher: empty notes produces no_notes** — 4 tests: count=1, id=no_notes, title="No notes yet", desc mentions ⌘N, icon Plus
14. **Note switcher: ID format and icons** — 4 tests: id="note_{uuid}", current=Check, regular=File, pinned+current=StarFilled
15. **New chat: empty inputs** — 4 tests: all empty=0, only models=1, only presets=1, only last_used=1
16. **to_deeplink_name: additional transformations** — 4 tests: numbers preserved, spaces to hyphens, already lowercase unchanged, single char
17. **Constants: secondary dimensions** — 4 tests: SECTION_HEADER_HEIGHT=22, HEADER_HEIGHT=24, ACTION_ROW_INSET=6, SELECTION_RADIUS=8
18. **Constants: keycap and accent bar** — 4 tests: KEYCAP_MIN_WIDTH=22, KEYCAP_HEIGHT=22, ACCENT_BAR_WIDTH=3, SEARCH_INPUT_HEIGHT=44
19. **parse_shortcut_keycaps: parsing** — 4 tests: ⌘↵→["⌘","↵"], all modifiers+K→5 keycaps, single letter, lowercase uppercased
20. **format_shortcut_hint: conversions** — 4 tests: cmd+backspace→⌘⌫, ctrl+tab→⌃⇥, option+space→⌥␣, escape→⎋
21. **build_grouped_items_static: None section handling** — 4 tests: None section no header, mixed Some/None, Separators never adds headers, empty filtered
22. **coerce_action_selection: patterns** — 4 tests: single item, header then item, item then header, beyond bounds clamped
23. **CommandBarConfig: close flags** — 4 tests: ai close_on_select, ai close_on_escape, main_menu close_on_select, notes close_on_escape
24. **Scriptlet reveal and copy_path** — 4 tests: reveal ⌘⇧F, desc mentions Finder, copy_path ⌘⇧C, desc mentions path
25. **Score action: fuzzy vs prefix vs contains** — 4 tests: fuzzy < prefix, contains < prefix, title+desc=115+, shortcut bonus≥10
26. **fuzzy_match: patterns** — 4 tests: exact, subsequence, no match, needle longer
27. **Cross-context: all produce non-empty actions** — 6 tests: script, builtin, scriptlet, file, path, AI bar
28. **Clipboard: share action details** — 4 tests: shortcut ⇧⌘E, title "Share...", desc mentions share, present for image
29. **Action builder: cached lowercase** — 4 tests: title_lower, description_lower, shortcut_lower after with_shortcut, None shortcut
30. **Cross-context: all built-in IDs snake_case** — 4 tests: script, file, path, clipboard all use snake_case IDs

## Verification

- `cargo check --lib` pass
- `cargo clippy --lib -- -D warnings` pass
- `RUST_MIN_STACK=67108864 cargo test --lib actions::dialog_builtin_action_validation_tests_35` 124 passed, 0 failed
- `git push` pass

## What to Avoid Repeating

- **Pre-existing bin compilation errors** from concurrent agents modifying `src/prompts/markdown.rs`, `src/ai/window.rs`, etc. Use `cargo check --lib` / `cargo clippy --lib` to avoid.
- **File locking**: If `LOCKED` error returned, skip file and work on others. Wait for lock to expire (~180s).
- **`cargo fmt` in pre-commit hook formats ALL modified files**: Run `cargo fmt` before committing.
- **Clipboard `attach_to_ai` shortcut is `⌃⌘A`** (Ctrl+Cmd+A), title is "Attach to AI Chat".
- **Clipboard text has 12 actions on macOS**, image has 16 (4 more: open_with, annotate_cleanshot, upload_cleanshot, ocr).
- **Pinned vs unpinned clipboard entries have same total action count** — pin/unpin just swap.
- **File context primary action title uses `Open "name"` format** (quoted filename) for both files and dirs.
- **Path context primary action descriptions differ**: file="Submit this file", dir="Navigate into this directory".
- **Edit shortcut ⌘E is consistent** across script, scriptlet (edit_scriptlet), and agent (edit_script).
- **Scriptlet custom action IDs use prefix `scriptlet_action:`** followed by the command slug.
- **Scriptlet custom actions have `has_action=true`**, builtins have `has_action=false`.
- **AI bar `copy_chat` shortcut is `⌥⇧⌘C`**, `copy_last_code` is `⌥⌘C` — both in "Response" section.
- **Chat model IDs use format `select_model_{model_id}`**, current model check is by display_name.
- **Notes `format` action**: shortcut ⇧⌘T, icon Code, section Edit, absent in trash.
- **Notes trash view has exactly 3 actions**: new_note, browse_notes, enable_auto_sizing.
- **Note switcher empty produces `no_notes` action** with icon Plus and desc mentioning ⌘N.
- **Note switcher ID format is `note_{uuid}`**.
- **Scriptlet `Scriptlet::new()` takes (name, tool, content)** all as `String`.
