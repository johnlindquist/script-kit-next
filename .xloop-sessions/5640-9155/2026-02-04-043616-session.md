# Session: Batch 25 Builtin Action Validation Tests

**Date**: 2026-02-04
**Commit**: b7558aa
**Branch**: main

## Summary

Created batch 25 of dialog builtin action validation tests with **119 tests** across **30 categories**, continuing the series from batches 1-24.

## Files Changed

- `src/actions/dialog_builtin_action_validation_tests_25.rs` (new, ~1536 lines) — 119 tests in 30 categories
- `src/actions/mod.rs` (+4 lines: test module registration for batch 25)

## What Was Improved

### New Tests (119 across 30 categories):

1. **Scriptlet context: reset_ranking placement is always last** — 4 tests: scriptlet, script, builtin, agent all have reset_ranking as last action when is_suggested=true
2. **Scriptlet context: copy_deeplink desc contains deeplink URL** — 4 tests: scriptlet URL, scriptlet shortcut ⌘⇧D, script URL, builtin URL
3. **Script context: full script action ordering invariants** — 4 tests: run_script first, copy_deeplink last (non-frecency), shortcut before edit, alias follows shortcut
4. **Script context: run_script title includes action_verb and quoted name** — 4 tests: default "Run", "Launch", "Switch to", description uses verb
5. **Clipboard: save_snippet and save_file shortcut details** — 5 tests: save_snippet ⇧⌘S, save_snippet title, save_file ⌥⇧⌘S, save_file title, save_file desc mentions file
6. **Clipboard: destructive action shortcuts matrix** — 4 tests: delete ⌃X, delete_multiple ⇧⌘X, delete_all ⌃⇧X, destructive at end
7. **Clipboard: quick_look shortcut is ␣ (macOS)** — 3 tests: shortcut ␣, title "Quick Look", present for both text and image
8. **Clipboard: paste_keep_open shortcut and description** — 3 tests: shortcut ⌥↵, desc mentions "keep", clipboard_copy ⌘↵
9. **AI command bar: section counts per category** — 6 tests: Response=3, Actions=4, Attachments=2, Export=1, Help=1, Settings=1
10. **AI command bar: branch_from_last has ArrowRight icon, no shortcut** — 4 tests: icon ArrowRight, no shortcut, section Actions, change_model no shortcut
11. **AI command bar: add_attachment details** — 4 tests: shortcut ⇧⌘A, icon Plus, section Attachments, paste_image icon File
12. **Notes command bar: copy section icon assignments** — 4 tests: copy_note_as=Copy, copy_deeplink=ArrowRight, create_quicklink=Star, export=ArrowRight
13. **Notes command bar: conditional duplicate_note logic** — 4 tests: absent in trash, absent without selection, present with selection+no trash, shortcut ⌘D
14. **Chat context: model ordering matches input order** — 3 tests: ordering preserved, description "via {provider}", continue_in_chat after models
15. **Chat context: copy_response conditional on has_response** — 4 tests: absent without response, present with response, shortcut ⌘C, clear_conversation requires messages
16. **New chat: preset description is always None** — 4 tests: description None, section Presets, ID format preset_{id}, icon preserved
17. **New chat: last_used description is provider_display_name** — 4 tests: description=provider_display_name, icon BoltFilled, section "Last Used Settings", model section "Models"
18. **Note switcher: preview truncation at 60 chars adds ellipsis** — 4 tests: 80 chars truncated with …, short no truncation, exactly 60 no truncation, 61 truncated
19. **Note switcher: current note has bullet prefix** — 3 tests: current has "• ", non-current no bullet, current icon Check
20. **Path context: open_in_editor mentions $EDITOR** — 4 tests: desc mentions $EDITOR, shortcut ⌘E, terminal desc, open_in_finder ⌘⇧F
21. **Path context: primary action shortcut always ↵** — 3 tests: dir ↵, file ↵, move_to_trash ⌘⌫
22. **File context macOS: show_info title and shortcut** — 2 tests: title "Get Info", shortcut ⌘I
23. **File context macOS: open_with title and shortcut** — 2 tests: title "Open With...", shortcut ⌘O
24. **to_deeplink_name: consecutive special chars collapse** — 4 tests: hyphens, spaces, mixed specials, dots all collapse to single hyphen
25. **to_deeplink_name: leading/trailing specials trimmed** — 4 tests: leading, trailing, both sides, all specials → empty
26. **format_shortcut_hint: tab/backspace/space keys** — 5 tests: tab→⇥, backspace→⌫, delete→⌫, space→␣, escape→⎋
27. **format_shortcut_hint: arrow key mappings** — 5 tests: up→↑, down→↓, left→←, right→→, arrowup→↑
28. **parse_shortcut_keycaps: ⇥ and ⌫ symbols** — 5 tests: ⇥ alone, ⌫ alone, ⌘⇥ pair, ⌘⌫ pair, ⌥␣ pair
29. **score_action: empty search matches as prefix** — 4 tests: empty=prefix (≥100), no match=0, prefix highest, description bonus
30. **Cross-context: script vs scriptlet vs builtin action count comparison** — 6 tests: script>builtin, scriptlet>builtin, agent>builtin, builtin=4, script=9, scriptlet=8

## Verification

- `cargo check --lib` pass
- `cargo clippy --lib -- -D warnings` pass
- `cargo test --lib actions::dialog_builtin_action_validation_tests_25` 119 passed, 0 failed
- `git push` pass

## What to Avoid Repeating

- **Pre-existing bin compilation errors** in `ai/window.rs` from concurrent agents. Use `cargo check --lib` / `cargo clippy --lib` to avoid.
- **`cargo fmt` in pre-commit hook formats ALL modified files**: Run `cargo fmt` before committing.
- **Clipboard destructive actions are always the last 3**: delete, delete_multiple, delete_all — in that order.
- **Clipboard delete shortcut is ⌃X** (Control+X), not ⌘X.
- **Clipboard save_file shortcut is ⌥⇧⌘S** (Option+Shift+Cmd+S) — 4 modifier keys.
- **AI command bar has exactly 12 actions** across 6 sections: Response(3), Actions(4), Attachments(2), Export(1), Help(1), Settings(1).
- **`to_deeplink_name` collapses consecutive special characters** into a single hyphen and trims leading/trailing hyphens.
- **Note switcher truncates previews at 60 chars** — exactly 60 is NOT truncated, 61+ gets truncated with "…".
- **Current note has bullet prefix "• "** and icon Check; pinned note has StarFilled (pinned trumps current for icon).
- **Path context primary action shortcut is always ↵** regardless of is_dir.
- **Script action ordering invariant**: run_script first → shortcut/alias → edit → type-specific → copy_deeplink last (or reset_ranking if suggested).
- **`run_script` description uses the action_verb**: e.g. "Open this item" for verb "Open".
