# Session: Validate random builtin action/dialog behaviors (batch 2)

## Files Changed
- `src/actions/dialog_builtin_action_validation_tests_2.rs` (new, 1948 lines)
- `src/actions/mod.rs` (+4 lines: test module registration)

## What Was Improved
Added 106 new tests (batch 2) validating built-in action behavioral invariants across window dialogs, complementing the 87 tests from batch 1:
- Action ID uniqueness within each of 7 contexts (script, file, clipboard, path, AI, notes, chat)
- Non-empty title and ID for all actions
- AI command bar: every action has icon and section assigned
- description_lower cache matches description across script, AI, path contexts
- shortcut_lower cache matches shortcut across script, clipboard contexts
- Notes conditional actions: duplicate/find/format/copy/export only with selection + non-trash
- Notes auto-sizing toggle only shown when disabled
- Chat conditional: copy_response only with has_response, clear_conversation only with has_messages
- Chat empty models still has continue_in_chat; full context has all 4 action types
- Clipboard image-specific actions (OCR) present for Image, absent for Text
- Clipboard image has strictly more actions than text
- Clipboard pin/unpin mutual exclusivity
- Clipboard paste title includes frontmost app name or "Active App" fallback
- Path is_dir variations: open_directory vs select_file primary, trash description varies
- File is_dir variations: open_directory vs open_file primary, no quick_look for dirs
- Agent has "Edit Agent" title, has reveal/copy_path/copy_content, lacks view_logs
- Builtin lacks edit/view_logs/reveal/copy_path/copy_content, has run/shortcut/alias/deeplink
- Note switcher: empty placeholder, singular/plural/zero character counts, icon hierarchy (pinned>current>default), bullet prefix for current, all have Notes section
- Score bonuses: description-only match nonzero, shortcut-only match nonzero, no match returns 0, title+description stack
- New chat action ID format: last_used_{n}, preset_{id}, model_{n}; empty sections return empty
- New chat descriptions: models/last_used have provider_display_name, presets have none
- Global actions always empty
- Deeplink name edge cases: multiple spaces collapsed, underscores to hyphens, special chars stripped, leading/trailing stripped
- CommandBarConfig preset specifics: ai_style (Top/Headers/icons), main_menu (Bottom/Separators/no icons), notes (Top/Separators/icons), no_search (Hidden)
- Grouped items: None style has no headers/separators and count matches filtered; Headers style produces headers; Separators style has no headers
- Coerce selection on notes grouped actions finds valid item
- title_lower correctness for AI, notes, note switcher contexts
- Scriptlet custom action shortcut formatted with symbols; description propagated
- All actions across script/clipboard/file/AI contexts have ActionCategory::ScriptContext
- File primary action title includes filename/dirname
- Frecency: not suggested lacks reset_ranking, suggested has it as last action
- All script/AI/path/file actions have descriptions
- Clipboard and path actions have no value field
- AI section header count is exactly 4
- Scriptlet context has shortcut/alias/deeplink/edit/reveal/copy
- Notes new_note and browse_notes always present across all 8 permutations
- Fuzzy match on real clipboard and notes action titles

## What to Avoid Repeating
- Temporary value lifetime issues with `action_ids(&get_*_actions(...))` pattern; always bind the Vec to a variable first (`let actions_tmp = get_*_actions(...); let ids = action_ids(&actions_tmp);`)
- When multiple `action_ids` calls exist in the same scope, use unique variable names (`actions_1`, `actions_2`, etc.)
- The linter may remove the `#[cfg(test)]` module registration from mod.rs during stash/unstash operations; verify it's still present after git operations
- Pre-existing test failures in `scripts::tests` (frecency) and `theme::presets` are not related to action tests
