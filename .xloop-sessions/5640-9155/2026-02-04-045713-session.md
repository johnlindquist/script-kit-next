# Session: Batch 28 Builtin Action Validation Tests

**Date**: 2026-02-04
**Commit**: d7a549e
**Branch**: main

## Summary

Created batch 28 of dialog builtin action validation tests with **117 tests** across **30 categories**, continuing the series from batches 1-27.

## Files Changed

- `src/actions/dialog_builtin_action_validation_tests_28.rs` (new, ~1520 lines) — 117 tests in 30 categories
- `src/actions/mod.rs` (+4 lines: test module registration for batch 28)

## What Was Improved

### New Tests (117 across 30 categories):

1. **Scriptlet context: copy_content shortcut and description** — 4 tests: shortcut ⌘⌥C, desc mentions content, title "Copy Content", has_action=false
2. **Scriptlet context: alias actions share shortcut with script context** — 4 tests: add_alias ⌘⇧A, update_alias when present, remove_alias ⌘⌥A, update_alias ⌘⇧A
3. **Script context: copy_content and copy_path shortcuts** — 4 tests: copy_content ⌘⌥C, copy_path ⌘⇧C, edit_script ⌘E, reveal ⌘⇧F
4. **Script context: view_logs details** — 4 tests: shortcut ⌘L, title "View Logs", desc mentions log, absent for builtin
5. **Clipboard: pinned entry produces clipboard_unpin** — 3 tests: pinned→unpin, unpinned→pin, pin/unpin share ⇧⌘P shortcut
6. **Clipboard: save_snippet title and description** — 3 tests: title "Save Text as Snippet", desc mentions scriptlet, save_file title "Save as File..."
7. **Clipboard: clipboard_copy description mentions "without pasting"** — 3 tests: copy desc "without pasting", paste desc "paste", share desc "share"
8. **File context: title includes quoted file name** — 4 tests: file quotes name, dir quotes name, file desc says application, dir desc says folder
9. **File context: reveal_in_finder description** — 3 tests: desc mentions Finder, copy_path desc mentions clipboard, copy_filename desc mentions filename
10. **Path context: move_to_trash description dynamic for dir vs file** — 4 tests: dir desc says folder, file desc says file, shortcut ⌘⌫, title "Move to Trash"
11. **Path context: select_file/open_directory title includes quoted name** — 4 tests: select quotes name, open_directory quotes name, select desc says submit, open desc says navigate
12. **AI command bar: toggle_shortcuts_help details** — 4 tests: shortcut ⌘/, icon Star, section Help, title "Keyboard Shortcuts"
13. **AI command bar: new_chat details** — 4 tests: shortcut ⌘N, icon Plus, section Actions, desc mentions new
14. **AI command bar: delete_chat details** — 4 tests: shortcut ⌘⌫, icon Trash, section Actions, desc mentions delete
15. **Chat context: continue_in_chat shortcut** — 3 tests: shortcut ⌘↵, desc mentions chat, always present with models+flags
16. **Chat context: clear_conversation details** — 4 tests: shortcut ⌘⌫, absent without messages, desc mentions clear, copy_response absent without response
17. **Notes: export section icon** — 4 tests: icon ArrowRight, section Export, shortcut ⇧⌘E, absent without selection
18. **Notes: browse_notes details** — 4 tests: shortcut ⌘P, icon FolderOpen, section Notes, always present even in trash
19. **Notes full mode action count** — 4 tests: full=10, auto_sizing_enabled=9, no_selection=3, trash=3
20. **Note switcher: pinned note icon and section** — 4 tests: pinned icon StarFilled, section Pinned, regular icon File, section Recent
21. **Note switcher: current note icon and title prefix** — 4 tests: current icon Check, bullet prefix "• ", non-current no bullet, pinned trumps current for icon
22. **New chat: model description is provider_display_name** — 4 tests: description=provider_display_name, icon Settings, section Models, title=display_name
23. **New chat: preset description is None** — 4 tests: description None, icon preserved, section Presets, title=name
24. **to_deeplink_name: basic transforms** — 4 tests: cmd+c→"cmd-c", "My Script"→"my-script", underscores→hyphens, empty→empty
25. **Action with_shortcut_opt: None vs Some** — 4 tests: Some sets shortcut+lower, None keeps None, with_shortcut sets lower, new has no lower
26. **Action with_icon and with_section** — 4 tests: with_icon sets field, new has no icon, with_section sets field, new has no section
27. **Action cached lowercase fields** — 4 tests: title_lower computed, description_lower computed, None when no desc, shortcut_lower after with_shortcut
28. **CommandBarConfig presets: dialog_config fields** — 4 tests: main_menu=Bottom, ai=Top, no_search=Hidden, notes=Top
29. **Cross-context: action ID uniqueness** — 4 tests: script IDs unique, clipboard IDs unique, AI IDs unique, path IDs unique
30. **Cross-context: all actions have non-empty title and id** — 6 tests: script, clipboard, notes, file, AI, path all have non-empty IDs/titles

## Verification

- `cargo check --lib` pass
- `cargo clippy --lib -- -D warnings` pass
- `cargo test --lib actions::dialog_builtin_action_validation_tests_28` 117 passed, 0 failed
- `git push` pass

## What to Avoid Repeating

- **Pre-existing bin compilation errors** in `ai/window.rs` from concurrent agents. Use `cargo check --lib` / `cargo clippy --lib` to avoid.
- **`cargo fmt` in pre-commit hook formats ALL modified files**: Run `cargo fmt` before committing.
- **Clipboard pin/unpin share the same shortcut ⇧⌘P** — the action ID toggles between `clipboard_pin` and `clipboard_unpin` based on `entry.pinned`.
- **Path move_to_trash description is dynamic**: "Delete folder" for dirs, "Delete file" for files.
- **File context title uses `Open "name"` format** with the file name in quotes.
- **Path select_file description says "Submit this file"**, while open_directory says "Navigate into this directory" — different verbs for different types.
- **Notes export action requires `has_selection=true` AND `!is_trash_view`** — it's absent in both no-selection and trash states.
- **Notes browse_notes is always present** regardless of selection, trash view, or auto-sizing state.
- **Note switcher pinned trumps current for icon**: is_pinned → StarFilled, else is_current → Check, else → File.
- **New chat preset description is always None** — presets only have name, icon, and section.
- **Action `with_shortcut_opt(None)` leaves both shortcut and shortcut_lower as None** — doesn't set empty strings.
- **All action IDs within a context are unique** — no duplicates in script, clipboard, AI, path, file, or notes contexts.
