# xloop session 2026-02-03-220237

## Goal
Validate built-in action builders produce correct actions across multiple contexts.

## Files changed
- `src/actions/builders.rs` — added `#[cfg(test)] #[path] mod` reference to new test file
- `src/actions/builders_tests.rs` — **new**, 36 tests covering 7 action builder contexts

## What was tested
| Builder | Key assertions |
|---------|---------------|
| `get_file_context_actions` | file vs dir primary action, Quick Look file-only, macOS-specific Open With/Get Info |
| `get_path_context_actions` | open_directory vs select_file primary, trash description "folder"/"file" |
| `get_clipboard_history_context_actions` | pin/unpin toggle, image-only OCR/CleanShot, paste title w/ app name |
| `get_chat_context_actions` | current model checkmark, copy_response conditional, clear conditional |
| `get_ai_command_bar_actions` | all 9 IDs present, sections correct, every action has icon |
| `get_notes_command_bar_actions` | selection-gated actions, trash view suppression, auto-sizing toggle |
| `get_scriptlet_context_actions_with_custom` | shortcut/alias add vs update/remove, scriptlet-specific IDs |
| `to_deeplink_name` | lowercase+hyphen, special char strip, alphanumeric preserve |
| `Action` struct | lowercase cache, has_action default, with_shortcut_opt(None) |

## Result
All 2681 tests pass (36 new + 2645 existing). cargo check + clippy clean.

## What to avoid repeating
- The pre-commit hook may rename the commit message if a staged notes/window.rs change sneaks in. Always `git reset HEAD` unrelated staged files before committing.
- builders.rs already has an inline `mod tests` — use `#[path]` with a different module name to add a second test file.
