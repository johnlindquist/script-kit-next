# Session: Harden menu ↔ built-in view transitions

## Files changed
- `src/app_impl.rs` — `go_back_or_close()` now performs full state reset
- `src/app_execute.rs` — ThemeChooserView and DesignGalleryView entry setup

## What was improved

### go_back_or_close (Escape from built-in → main menu)
Previously missing: `computed_filter_text` clear, `filter_coalescer` reset,
`pending_filter_sync`, grouped cache invalidation, `sync_list_state()`,
`hovered_index` clear, `validate_selection_bounds()`, scroll-to-top, and
`last_scrolled_index` reset. These could cause stale search results, ghost
hover highlights, wrong scroll position, and filter desync when returning
from any built-in view (Clipboard History, Window Switcher, Theme Chooser,
File Search, Design Gallery, Scratch Pad, Quick Terminal) to the main menu.

### ThemeChooserView entry
Was missing `filter_text` clear, `pending_filter_sync`, and placeholder
("Search themes..."). Now matches the pattern used by ClipboardHistory,
AppLauncher, and WindowSwitcher.

### DesignGalleryView entry
Was missing `filter_text` clear, `pending_filter_sync`, placeholder
("Search designs..."), and focus setup (`pending_focus` + `focused_input`).
Now consistent with other built-in views.

## What to avoid repeating
- When adding new built-in views, always match the full entry setup pattern:
  clear `filter_text`, set `pending_filter_sync = true`, set
  `pending_placeholder`, set `pending_focus` and `focused_input`.
- `go_back_or_close` and `reset_to_script_list` must stay in sync — any
  state cleared in `reset_to_script_list` should also be cleared in the
  "return to menu" branch of `go_back_or_close`.
