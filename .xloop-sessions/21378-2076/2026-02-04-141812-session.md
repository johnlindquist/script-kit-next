# Session: Harden built-in view navigation consistency and state cleanup

## Files changed
- `src/render_builtins.rs` — ThemeChooser arrow key wrapping removed, DesignGallery filtered count fixed, ThemeChooser ESC guard added
- `src/app_impl.rs` — ClipboardHistory focused entry ID updated after filter clear, actions popup cleared in go_back_or_close
- `src/app_execute.rs` — Actions popup cleared at top of execute_builtin
- `src/designs/group_header_variations.rs` — Added #[allow(dead_code)] for functions only used in tests

## What was improved

### ThemeChooser Up/Down no longer wraps around
Previously, pressing Up at the first theme jumped to the last theme, and
pressing Down at the last theme jumped to the first. All other built-in
views (ClipboardHistory, AppLauncher, WindowSwitcher, DesignGallery,
FileSearch) stop at the boundary. Now ThemeChooser matches the
consistent behavior.

### DesignGallery uses filtered count for navigation bounds
The key handler was computing `current_filtered_len` from the total
number of gallery items (ignoring the filter), which meant arrow keys
could navigate past the visible items when a filter was active. Now
captures the actual `filtered_len` from the render function.

### ClipboardHistory updates focused entry after filter clear
When ESC cleared the filter in ClipboardHistory, `focused_clipboard_entry_id`
was not updated to reflect the new selection (first unfiltered entry).
This could cause stale entry details to display between the filter clear
and the next key press.

### Actions popup cleared on view transitions
`go_back_or_close` (return to main menu) and `execute_builtin` (enter a
built-in view) now clear `show_actions_popup` and `actions_dialog`.
Previously these fields were only cleared in `reset_to_script_list`,
meaning `go_back_or_close`'s lighter return-to-menu path could leave
stale popup state.

### ThemeChooser ESC respects actions popup guard
Added `!this.show_actions_popup` guard to ThemeChooser's ESC handler,
matching the pattern used by ClipboardHistory, AppLauncher,
WindowSwitcher, and DesignGallery. ThemeChooser was the only view
without this guard and without `route_actions_key` before its ESC check.

## What to avoid repeating
- When adding new built-in views with arrow key navigation, always stop
  at boundaries (don't wrap). The pattern is `if *selected_index > 0`
  for Up and `if *selected_index < count - 1` for Down.
- Key handler closures that need filtered item counts should capture the
  count from the render function rather than recomputing from totals,
  which may not account for the active filter.
- Both `go_back_or_close` and `execute_builtin` must clear actions popup
  state — `reset_to_script_list` alone is not sufficient since
  `go_back_or_close` uses a lighter code path.
