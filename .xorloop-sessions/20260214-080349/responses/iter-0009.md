Excellent. I now have a complete picture. Let me compile the analysis into swarm tasks.

Here are the analysis results:

---

## SWARM TASK LIST

### Task 1: `fix-storybook-browser-theme`

**Scope:** `src/storybook/browser.rs`

**Task:**
The `StoryBrowser` in `src/storybook/browser.rs` has 27 hardcoded `rgb(0x...)` calls that violate the project convention "Use `theme.colors.*` — never hardcode `rgb(0x...)`". The file already imports `crate::theme::Theme` and stores a `current_theme: Theme` field, but never uses it for colors. Every color in the browser UI is a raw hex literal: `rgb(0x1e1e1e)` for backgrounds, `rgb(0x3d3d3d)` for borders, `rgb(0xffffff)` for primary text, `rgb(0xcccccc)` for secondary text, `rgb(0x666666)` for dimmed text, `rgb(0x888888)` for muted text/labels, `rgb(0x2d2d2d)` for input/toolbar backgrounds, `rgb(0x252525)` for sidebar backgrounds, and `rgb(0x4a90d9)` for selected item highlight.

Replace every `rgb(0x...)` call with the corresponding `theme.colors.*` field using `crate::theme::get_cached_theme()`. At the top of each render method (`render`, `render_search_bar`, `render_story_list`, `render_toolbar`, `render_preview`), add `let theme = crate::theme::get_cached_theme();`. Then make these substitutions throughout: `rgb(0x1e1e1e)` → `rgb(theme.colors.background.main)`, `rgb(0x2d2d2d)` → `rgb(theme.colors.background.title_bar)` (closest: title_bar is 0x2d2d30), `rgb(0x252525)` → `rgb(theme.colors.background.title_bar)` (sidebar panel bg), `rgb(0x3d3d3d)` → `rgb(theme.colors.ui.border)` (all border usages + hover bg + divider bg), `rgb(0xffffff)` → `rgb(theme.colors.text.primary)`, `rgb(0xcccccc)` → `rgb(theme.colors.text.secondary)`, `rgb(0x888888)` → `rgb(theme.colors.text.tertiary)` (closest match for label/muted text), `rgb(0x666666)` → `rgb(theme.colors.text.dimmed)`, `rgb(0x4a90d9)` → `rgb(theme.colors.ui.info)` (selected item highlight — the blue accent). For the hover background `s.bg(rgb(0x3d3d3d))` in the story list, use `rgb(theme.colors.ui.border)` as the hover fill, which matches the border tone. Remove the `#[allow(dead_code)]` on the `current_theme` field since it was only there because the field was unused.

The `Render::render` method receives `cx: &mut Context<Self>` but `get_cached_theme()` is a free function that reads from a static cache, so no context is needed. Do NOT change the `Story` trait or `StoryEntry` struct. Do NOT change story selection logic, keyboard handling, or screenshot capture. After changes, run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` to verify. The storybook is a dev tool, so visual differences from slightly different hex values (e.g., 0x2d2d2d vs 0x2d2d30 for title_bar) are acceptable — what matters is theme-reactivity.

### Task 2: `fix-storybook-layout-theme`

**Scope:** `src/storybook/layout.rs`

**Task:**
The storybook layout helpers in `src/storybook/layout.rs` contain 5 hardcoded `rgb(0x...)` calls in free functions (`story_container`, `story_section`, `story_item`, `code_block`, `story_divider`). These are: `rgb(0x1e1e1e)` background in `story_container()`, `rgb(0x888888)` text in `story_section()`, `rgb(0x666666)` text in `story_item()`, `rgb(0x2d2d2d)` background in `code_block()`, and `rgb(0x3d3d3d)` background in `story_divider()`. Additionally, `code_block()` uses `.font_family("Menlo")` instead of the project's `FONT_MONO` constant (`"SF Mono"` defined in `src/list_item/mod.rs`).

Add `use crate::theme::get_cached_theme;` and `use crate::list_item::FONT_MONO;` at the top of the file. In each function body, call `let theme = get_cached_theme();` at the start, then replace: `rgb(0x1e1e1e)` → `rgb(theme.colors.background.main)`, `rgb(0x888888)` → `rgb(theme.colors.text.tertiary)`, `rgb(0x666666)` → `rgb(theme.colors.text.dimmed)`, `rgb(0x2d2d2d)` → `rgb(theme.colors.background.title_bar)`, `rgb(0x3d3d3d)` → `rgb(theme.colors.ui.border)`. Replace `.font_family("Menlo")` with `.font_family(FONT_MONO)`.

These are all public free functions (`pub fn`) exported from `src/storybook/mod.rs`. They return `Div` and are called from story implementations in `src/stories/`. Do NOT change the function signatures or return types. Do NOT modify any files in `src/stories/`. Run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` to verify compilation and lint pass. The `FONT_MONO` constant is already `pub(crate)` so it's accessible from the storybook module.

### Task 3: `fix-menlo-to-font-mono`

**Scope:** `src/prompts/markdown/inline_render.rs, src/prompts/markdown/code_table.rs, src/prompts/div/render_html.rs, src/prompts/div/inline.rs, src/term_prompt/mod.rs`

**Task:**
Six files in the `src/prompts/` directory and one in `src/term_prompt/` use hardcoded `.font_family("Menlo")` instead of the project's `FONT_MONO` constant (`"SF Mono"`, defined as `pub(crate) const FONT_MONO: &str = "SF Mono"` in `src/list_item/mod.rs`). The affected call sites are: `src/prompts/markdown/inline_render.rs` lines 16 and 206 (inline code spans), `src/prompts/markdown/code_table.rs` line 141 (code block rendering), `src/prompts/div/render_html.rs` lines 81 and 109 (HTML `<code>` and `<pre>` elements), `src/prompts/div/inline.rs` line 144 (inline code), and `src/term_prompt/mod.rs` line 682 (terminal prompt). Previous commit `3ec6188e` already fixed the same issue in toast, establishing the pattern.

In each file, add `use crate::list_item::FONT_MONO;` to the imports (if not already present), then replace every `.font_family("Menlo")` with `.font_family(FONT_MONO)`. The constant is `pub(crate)` and already used in `src/list_item/mod.rs`, `src/main.rs`, `src/render_script_list/mod.rs`, and `src/designs/apple_hig.rs`, so the pattern is well-established.

Do NOT change any files in `src/stories/` (story files are dev-only previews). Do NOT change documentation or markdown files. Do NOT rename or move the constant. After replacement, run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` to confirm everything compiles and passes. If any file already imports from `crate::list_item`, add `FONT_MONO` to the existing import rather than adding a duplicate use statement.

### Task 4: `fix-stories-menlo-font`

**Scope:** `src/stories/list_item_stories.rs, src/stories/design_token_stories.rs, src/stories/env_prompt_stories/split.rs`

**Task:**
Three story files use hardcoded `.font_family("Menlo")` instead of `FONT_MONO`: `src/stories/list_item_stories.rs` line 324, `src/stories/design_token_stories.rs` line 198, and `src/stories/env_prompt_stories/split.rs` line 702. While stories are dev-only previews, they should still follow project conventions for consistency and to serve as correct examples of component usage.

In each file, add `use crate::list_item::FONT_MONO;` to the imports (or add `FONT_MONO` to an existing `crate::list_item` import), then replace `.font_family("Menlo")` with `.font_family(FONT_MONO)`. The constant is defined as `pub(crate) const FONT_MONO: &str = "SF Mono"` in `src/list_item/mod.rs`.

Do NOT modify any non-story source files — those are covered by a separate task. Run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` after changes. If a file already imports other items from `crate::list_item`, merge `FONT_MONO` into the existing import statement.

---

NEXT_AREA: `src/stories/` — 150 hardcoded `rgb(0x...)` calls across 20 story files; these should use `get_cached_theme()` like the storybook browser, following the same pattern established by tasks 1-2 above.
