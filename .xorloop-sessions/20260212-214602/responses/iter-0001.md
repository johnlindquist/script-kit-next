Here's the full GPT-5.2 Pro security audit of the frecency scoring system:

---

## Frecency Security Audit — 8 Findings

### MAJOR (3 items)

**1. Unbounded JSON deserialization — DoS risk**
- `src/frecency/mod.rs:240-269` — `FrecencyStore::load`
- `read_to_string()` + `serde_json::from_str()` with no size bounds. A huge `frecency.json` causes memory exhaustion. Corrupt JSON may crash startup.
- **Fix:** Add `MAX_FRECENCY_BYTES` (2 MiB) check on file metadata before reading. Use `BufReader::take()`. Quarantine corrupt files instead of failing fatally.

**2. Atomic write not hardened — predictable temp path, no fsync, symlink risk**
- `src/frecency/mod.rs:275-318` — `FrecencyStore::save`
- `src/setup/mod.rs:361-407` — `write_string_if_changed`
- Deterministic `.json.tmp` temp name is followable by symlink. No `sync_all()` before rename means crash can produce corrupt file.
- **Fix:** Use `tempfile` crate (`tempfile_in(parent)` + `persist()`) or at minimum `OpenOptions::create_new(true)` + `sync_all()`.

**3. Frecency file created world-readable + sensitive filter text logged verbatim**
- `src/frecency/mod.rs:282-307` — file perms
- `src/app_impl/filtering_cache.rs` — logs raw `filter_text`
- Users may paste tokens/passwords into search. File is `0644` by default.
- **Fix:** Set `0600` perms on frecency file. Log `filter_text.len()` not content.

### MINOR (5 items)

**4. Half-life NaN propagation**
- `src/frecency/mod.rs:45-51` — `decay_factor`
- `.max(0.001)` doesn't guard against NaN. NaN half-life → NaN scores everywhere.
- **Fix:** `sanitize_half_life_days()` — return default if `!v.is_finite() || v <= 0.0`.

**5. Ranking manipulation via crafted JSON**
- `src/frecency/mod.rs:250-259` — load trusts all values
- Future timestamps → no decay → permanent top rank. Giant keys bloat memory.
- **Fix:** During load: clamp `last_used` to `now + 24h`, cap `count` at 1M, drop keys > 2KB.

**6. Frecency store path is hardcoded (good) — but `kenv_path`/`kit_path` not in scope**
- `src/frecency/mod.rs:231-233` — `default_path`
- No path traversal risk in frecency itself, but config-derived paths weren't auditable.
- **Fix:** If path overrides are ever added, canonicalize + `starts_with()` guard.

**7. Cache doesn't include frecency revision — stale rankings**
- `src/app_impl/filtering_cache.rs:100-195` — `get_grouped_results_cached`
- Cache key only checks filter text, not frecency revision. Same filter + changed scores = stale.
- **Fix:** Add `grouped_cache_frecency_revision: u64` field, check alongside cache key.

**8. Secret leak via frecency log entries**
- `src/frecency/mod.rs:326-356` — `record_use` logs full path
- Script paths may contain project/client names.
- **Fix:** Log basename or hash only.

---

**NEXT_AREA:** Audit `kenv_path`/`kit_path`/`db_path` construction and the logging subsystem's file permissions/rotation — those determine whether local-only data stays private and whether config-controlled paths can escape intended directories.
