## Oracle Security Audit Results: Emoji Picker

GPT-5.2 Pro identified **4 findings** (no critical, 1 major, 3 minor):

---

### Finding 1 — Unbounded search input → memory/CPU DoS (MAJOR)
**Files:** `src/app_impl/filter_input_change.rs`, `src/emoji/mod.rs`

The filter string is fully trusted. A multi-MB paste into the search box triggers `.to_string()` + `.to_ascii_lowercase()` clones, stalling the UI thread.

**Fix:** Clamp input to `512` bytes (UTF-8 boundary-safe) before storing/lowercasing. Add `MAX_EMOJI_QUERY_BYTES` constant in `src/emoji/mod.rs` and enforce at both the filter handler and `search_emojis()`.

---

### Finding 2 — No clipboard output validation for bidi/control chars (MINOR)
**Files:** `src/render_builtins/emoji_picker.rs` (Enter handler ~L189, click handler ~L351)

Emoji strings go directly to clipboard without checking for bidi override chars or control characters. Currently low risk (static data), but a defense-in-depth gap if emoji data is ever externalized.

**Fix:** Add `is_safe_emoji_clipboard_text()` validator that allows ZWJ/variation selectors but blocks bidi controls (`U+202A–U+202E`, `U+2066–U+2069`) and other C0/C1 controls.

---

### Finding 3 — Emoji picker bypasses built-in feature gating (MINOR)
**Files:** `src/builtins/mod.rs` (~L468), `src/app_execute/builtin_execution.rs` (~L494)

Other built-ins are conditionally registered via `BuiltInConfig`, but Emoji Picker is always registered unconditionally. No way to disable it via config.

**Fix:** Add `emoji_picker: bool` to `BuiltInConfig` and gate both registration and execution.

---

### Finding 4 — Unchecked slice indexing in row construction → panic DoS (MINOR)
**Files:** `src/render_builtins/emoji_picker.rs` (~L68)

`ordered_emojis[flat_offset..]` panics if `flat_offset > len`. Invariant holds today but is fragile.

**Fix:** Replace with `ordered_emojis.get(flat_offset..).unwrap_or(&[])`.

---

### Notable: No findings for
- No `unsafe` blocks in the emoji picker path
- No deserialization or file/path handling
- No secret leaks

**NEXT_AREA:** Audit the **clipboard integration layer** (`cx.write_to_clipboard` / macOS `NSPasteboard` types) — confirm it writes only plain UTF-8 strings with no extra pasteboard flavors that could enable injection or data leakage.
