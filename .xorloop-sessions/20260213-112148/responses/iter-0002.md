Excellent. Now I have a thorough understanding of the codebase. Let me analyze the DRY violations I've found:

**DRY violation 1 (highest impact):** Five functions in `other.rs` (lines 109-215) — `render_select_prompt`, `render_env_prompt`, `render_drop_prompt`, `render_template_prompt`, `render_naming_prompt` — have **identical bodies** differing only in the `Entity<T>` type. Since `prompt_shell_content()` already accepts `impl IntoElement`, and `Entity<T>` implements `IntoElement` for any `T: Render`, a single generic helper can replace all five. The sixth function (`render_chat_prompt`) uses a different key handler (`other_prompt_shell_handle_key_chat`) but the same shell pattern.

**DRY violation 2:** The `has_actions` check (`self.sdk_actions.is_some() && !self.sdk_actions.as_ref().unwrap().is_empty()`) is copy-pasted in 4 render files. It's also slightly dangerous — `.unwrap()` after `.is_some()` is safe but unnecessary when a method could just use `as_ref().is_some_and(|a| !a.is_empty())` or a helper.

**DRY violation 3:** Dead `create_box_shadows()` calls — 7 places call `let _box_shadows = self.create_box_shadows()` or `let _ = self.create_box_shadows()`, discarding the result. The comment says "Shadows are handled by app_shell" — these are dead code.

Here's the swarm task list based on my analysis:

---

### Task 1: `unify-simple-prompt-wrappers`

**Scope:** `src/render_prompts/other.rs`, `src/main_sections/render_impl.rs`, `src/components/prompt_layout_shell.rs`

**Task:**
In `src/render_prompts/other.rs` lines 109-215, there are six render methods (`render_select_prompt`, `render_env_prompt`, `render_drop_prompt`, `render_template_prompt`, `render_naming_prompt`, `render_chat_prompt`) whose bodies are identical except for which `Entity<T>` is passed and which key handler closure is used. Five of them use `cx.listener(Self::other_prompt_shell_handle_key_default)` and `render_chat_prompt` uses `cx.listener(Self::other_prompt_shell_handle_key_chat)`. In every case the body is: `let shell_radius = self.other_prompt_shell_radius_lg();` → `let handle_key = cx.listener(...)` → `let vibrancy_bg = get_vibrancy_background(&self.theme);` → `prompt_shell_container(shell_radius, vibrancy_bg).on_key_down(handle_key).child(prompt_shell_content(entity)).into_any_element()`. Since `prompt_shell_content()` already accepts `impl IntoElement` and `Entity<T>` implements `IntoElement` for any `T: Render`, a single private helper can replace all six methods.

Add a new private method to `ScriptListApp` in `other.rs`:
```rust
fn render_simple_prompt_shell(
    &mut self,
    entity: impl IntoElement,
    key_handler: impl Fn(&mut Self, &gpui::KeyDownEvent, &mut Window, &mut Context<Self>) + 'static,
    cx: &mut Context<Self>,
) -> AnyElement {
    let shell_radius = self.other_prompt_shell_radius_lg();
    let handle_key = cx.listener(key_handler);
    let vibrancy_bg = get_vibrancy_background(&self.theme);
    crate::components::prompt_shell_container(shell_radius, vibrancy_bg)
        .on_key_down(handle_key)
        .child(crate::components::prompt_shell_content(entity))
        .into_any_element()
}
```
Then replace each of the six methods with one-liners:
```rust
fn render_select_prompt(&mut self, entity: Entity<SelectPrompt>, cx: &mut Context<Self>) -> AnyElement {
    self.render_simple_prompt_shell(entity, Self::other_prompt_shell_handle_key_default, cx)
}
```
Do the same for `render_env_prompt`, `render_drop_prompt`, `render_template_prompt`, `render_naming_prompt` (all use `Self::other_prompt_shell_handle_key_default`), and `render_chat_prompt` (uses `Self::other_prompt_shell_handle_key_chat`).

The existing test in `other.rs` at line 363 (`other_prompt_render_wrapper_tests`) and the test in `src/components/prompt_layout_shell.rs` at line 124 (`simple_prompt_wrappers_use_shared_layout_shell`) both use source-string matching. The source-string test in `prompt_layout_shell.rs` checks that each method body contains `"prompt_shell_container("` and `"prompt_shell_content("` — those strings will now appear in `render_simple_prompt_shell` instead. You need to update those tests to check for `render_simple_prompt_shell` in each wrapper body, or update the source-scan targets to look for the new helper name. The `other_prompt_render_wrapper_tests` test at line 377 checks for absence of `hex_to_rgba_with_opacity` and `create_box_shadows` — those will still be absent, so that test should still pass. Run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` to verify.

---

### Task 2: `extract-has-sdk-actions-helper`

**Scope:** `src/render_prompts/div.rs`, `src/render_prompts/editor.rs`, `src/render_prompts/term.rs`, `src/render_prompts/form/render.rs`, `src/render_prompts/arg/render.rs`

**Task:**
The expression `self.sdk_actions.is_some() && !self.sdk_actions.as_ref().unwrap().is_empty()` is copy-pasted in 4 render files: `div.rs:26`, `editor.rs:64`, `term.rs:125`, `form/render.rs:16`. A nearly identical pattern appears in `arg/render.rs:102` as `actions.is_some() && !actions.as_ref().unwrap().is_empty()` (checking a local `actions` variable rather than `self.sdk_actions`). The `.unwrap()` after `.is_some()` is safe but it violates the project's "no unwrap in production" rule from CLAUDE.md. There is already a `has_actions()` method on `ScriptListApp` in `src/app_actions/handle_action.rs:186` but it does something different (checks menu actions, not SDK actions). There is also `has_sdk_actions()` on `ActionsDialog` at `src/actions/dialog.rs:857` and on `NotesActionsPanel` at `src/notes/actions_panel.rs:387`.

Add a new `#[inline]` helper method to `ScriptListApp` (place it in the shared render_prompts helpers area, or in `other.rs` since it's shared across prompts):
```rust
#[inline]
fn has_nonempty_sdk_actions(&self) -> bool {
    self.sdk_actions.as_ref().is_some_and(|a| !a.is_empty())
}
```
Then replace all 4 occurrences in render files:
- `div.rs:25-26`: `let has_actions = self.has_nonempty_sdk_actions();`
- `editor.rs:63-64`: `let has_actions = self.has_nonempty_sdk_actions();`
- `term.rs:124-125`: `let has_actions = self.has_nonempty_sdk_actions();`
- `form/render.rs:15-16`: `let has_actions = self.has_nonempty_sdk_actions();`

Do NOT change `arg/render.rs:102` since that checks a local `actions` parameter, not `self.sdk_actions`. Run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` to verify. Make sure the method is visible across all render_prompts files — since these files are included via `include!()` into the main module, a private method on `ScriptListApp` is accessible from all of them.

---

### Task 3: `rm-dead-box-shadow-calls`

**Scope:** `src/render_prompts/div.rs`, `src/render_prompts/editor.rs`, `src/render_prompts/term.rs`, `src/render_prompts/path.rs`, `src/render_prompts/form/render.rs`, `src/render_prompts/arg/render.rs`, `src/render_prompts/arg/render_prompt.rs`

**Task:**
Seven render methods call `self.create_box_shadows()` and immediately discard the result: `div.rs:96` (`let _ = self.create_box_shadows()`), `editor.rs:74`, `term.rs:136`, `path.rs:197`, `form/render.rs:160`, `arg/render.rs:305`, `arg/render_prompt.rs:230` (all `let _box_shadows = self.create_box_shadows()`). Every call site has a comment saying "No shadow - shadows on transparent elements cause gray fill with vibrancy / Shadows are handled by app_shell". The return value is never used — the underscore prefix on the variable or the `let _` pattern confirms this. These are dead code.

Delete each of the 7 calls and their preceding/trailing comments. Specifically remove:
- In `div.rs`: lines 94-96 (`// NOTE: No shadow...` comment + `let _ = self.create_box_shadows();`)
- In `editor.rs`: lines 72-74 (`// NOTE: No shadow...` comment + `let _box_shadows = self.create_box_shadows();`)
- In `term.rs`: lines 134-136 (same pattern)
- In `path.rs`: lines 195-197 (same pattern)
- In `form/render.rs`: lines 158-160 (same pattern)
- In `arg/render.rs`: lines 303-305 (same pattern)
- In `arg/render_prompt.rs`: lines 228-230 (same pattern)

Also remove any `_bg_with_alpha` dead computations in files where the result is assigned to a `_` prefixed variable and never used. In `path.rs:193-194`: `let _bg_with_alpha = crate::ui_foundation::hex_to_rgba_with_opacity(bg_hex, opacity.main);` — this is also dead code since `bg_with_alpha` is never read. Similarly in `arg/render.rs:301-302`: `let _bg_with_alpha = crate::ui_foundation::hex_to_rgba_with_opacity(bg_hex, opacity.main);` is dead. Remove these too, along with the `opacity` and `bg_hex` locals if they become unused.

Run `cargo check && cargo clippy --all-targets -- -D warnings && cargo test` to verify nothing breaks. If clippy reports new unused-variable warnings from removing these, also remove the now-orphaned variable bindings.

---

NEXT_AREA: **Key handler closures** — the `handle_key` closures across div.rs, editor.rs, term.rs, form/render.rs, and arg/render.rs all share the same structure: `hide_mouse_cursor` → `key_preamble` → extract key/modifiers → Cmd+K toggle → `route_key_to_actions_dialog` match → `check_sdk_action_shortcut` fallback. This 40-50 line closure is copy-pasted 5 times with minor variations, and could potentially be factored into a shared key-routing function that accepts a config struct for the prompt-specific differences.
