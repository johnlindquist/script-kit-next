Here's the Oracle GPT-5.2 Pro analysis of documentation gaps in the KeywordMatcher text-expansion pipeline:

---

## Documentation Gaps — Prioritized Checklist

### CRITICAL (3 items)

| # | File | Category | Fix |
|---|------|----------|-----|
| 1 | `src/keystroke_logger.rs:45-113` | missing safety doc | Add safety/privacy docs: `recent_chars` records typed characters and logs them at debug level — can include sensitive input. Document what's captured (ASCII graphic/alphanumeric/space, last 10 chars, 5s flush window), operational guidance (debug-only, not production), and thread-safety guarantees. |
| 2 | `src/text_injector.rs:44-147` | missing safety doc | Add `# Safety` sections: sends synthetic keystrokes to the *focused app* (can delete data if focus changes), temporarily overwrites system clipboard (non-text content won't be restored), macOS-only via Core Graphics, requires Accessibility permissions. Document timing delays and their purpose. |
| 3 | `src/keyword_manager/mod.rs:152-257` | missing safety doc | Document `enable()` side effects: system-wide keyboard monitoring, Accessibility permission requirement, threading model (callback → spawned expansion thread), race condition between trigger match and injection when focus changes, buffer clearing behavior post-match. |

### MAJOR (14 items)

| # | File | Lines | Category | Fix |
|---|------|-------|----------|-----|
| 4 | `keystroke_logger.rs:29-119` | undocumented API | Add `///` docs to `KeystrokeLogger`, all `pub fn` methods, and the `keystroke_logger()` singleton. Document counter semantics, `maybe_flush` behavior, why `log_match()` forces flush. |
| 5 | `keystroke_logger.rs:1-28` | missing arch doc | Module-level `//!` explaining where logger fits in the pipeline, what it diagnoses, what it deliberately doesn't do (full keylogging, persistence). |
| 6 | `text_injector.rs:7-107` | undocumented API | Add `///` docs for `TextInjectorConfig` fields (units, defaults, what each delay protects against), `TextInjector` methods. |
| 7 | `text_injector.rs:44-147` | missing error doc | Add `# Errors` sections: clipboard access failures, CGEvent creation failures, restoration failures logged as warn but don't fail the operation. |
| 8 | `text_injector.rs:1-6` | missing arch doc | Module-level docs on injection strategy (backspace + clipboard paste), why this pattern (reliability), known limitations (apps blocking Cmd+V, IME). |
| 9 | `keyword_manager/mod.rs:17-655` | undocumented API | Doc all public structs/functions. Note `restart_delay_ms` appears unused in runtime — document as reserved or remove. Document lifecycle: create → load → enable → disable on drop. |
| 10 | `keyword_manager/mod.rs:152-257` | missing error doc | `# Errors` for `enable()`: what `KeyboardMonitorError` represents, partial state on failure. |
| 11 | `keyword_manager/mod.rs:566-590` | missing error doc | Document `init_keyword_manager()` return semantics: `Ok(None)` = unavailable, `Ok(Some(0))` = no triggers, `Ok(Some(n))` = active, `Err` = lock/load failure. Note OnceLock idempotency. |
| 12 | `keyword_manager/mod.rs:197-247` | missing arch doc | Document supported tool behavior: `paste`/`type`/`template` → raw text injection; others → raw content fallback with log warning. "type" doesn't simulate per-character typing. |
| 13 | `keyword_manager/mod.rs:67-113` | missing arch doc | Document trigger discovery (`scriptlet.keyword`), path normalization (`#` fragment stripping), duplicate handling (overwrites), dummy path purpose. |
| 14 | `keyword_manager/mod.rs:1-16` | missing arch doc | Add subsystem-level `//!` docs: responsibilities, dataflow (monitor→matcher→lookup→substitution→injector), threading model, pointer to a subsystem README. |
| 15 | `keyword_matcher/mod.rs:1-11` | missing arch doc | Document the matching algorithm: rolling buffer, clear-on characters, last-char index for O(1) candidate lookup, O(k) suffix compare. |
| 16 | `keyword_matcher/mod.rs:12-157` | undocumented API | Doc `MatchResult`, `KeywordMatcher`, all public methods. Cover: `chars_to_delete` = char count not bytes, case-sensitive, suffix-based (no word boundaries), default buffer size. |
| 17 | `keyword_matcher/mod.rs:158-207` | missing arch doc | Document prefix ambiguity: shorter triggers fire immediately and prevent longer triggers with shared prefix (`:sig` blocks `:signature`). Add trigger design guidance. |

### MINOR (5 items)

| # | File | Lines | Category | Fix |
|---|------|-------|----------|-----|
| 18 | `keystroke_logger.rs:117-119` | missing example | Add usage example via singleton showing `record_keystroke`, `update_buffer_state`, privacy warning. |
| 19 | `text_injector.rs:30-107` | missing example | Minimal example: `delete_chars(matched.chars_to_delete)` → `paste_text(&replacement)`, clipboard/focus warning. |
| 20 | `keyword_matcher/mod.rs:59-110` | missing example | Example: register trigger, feed keystrokes, use `chars_to_delete`. |
| 21 | `scriptlets/mod.rs:885-1005` | missing example | Examples for `format_scriptlet` and `process_conditionals` showing named inputs, positional args, conditionals. |
| 22 | `scriptlets/mod.rs:89-115` | stale comment | Replace `// Public API for future use` with stability note in rustdoc or remove — currently reads as a vague promise. |

---

**NEXT_AREA:** Review `crate::keyboard_monitor` (event model, permission behavior, error types, and callback threading guarantees) for safety + API documentation gaps.
