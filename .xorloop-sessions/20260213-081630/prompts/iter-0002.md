<previous-analyses>
Here's the extracted fix list:

- [critical] src/main_sections/fallbacks.rs::execute_fallback_action — Wrong escape order enables AppleScript injection from search bar
- [major] src/file_search/mod.rs::open_in_terminal — Redundant `quoted form of` on already-escaped AppleScript string
- [major] src/scriptlets/mod.rs::substitute_args — No escaping on individual `$N`/`%N` shell argument substitution
- [minor] src/executor/scriptlet.rs::execute_type — Inline AppleScript escaping instead of shared `utils` helper
- [minor] src/file_search/mod.rs::escape_applescript — Duplicate escape function should use canonical `utils` helper

NEXT_AREA: `meval::eval_str()` resource exhaustion in fallbacks.rs Calculate handler
---
</previous-analyses>

Do NOT repeat items already covered above. Find something new.
## Target Code

FEATURE: Secrets encryption using a passphrase derived solely from the machine hostname, which is predictable and publicly discoverable, making the encrypted secrets file trivially decryptable by any local user or anyone who copies the file
FILES: src/secrets.rs, src/ai/config.rs, src/prompts/env/prompt.rs, src/ai/window/setup.rs
SMELL: `derive_passphrase()` at secrets.rs:125-132 concatenates the hostname with a hardcoded constant (`com.scriptkit.secrets`) as the age/scrypt passphrase — both values are publicly known, so any attacker with read access to `~/.scriptkit/secrets.age` can decrypt all stored API keys (OPENAI, VERCEL, etc.) offline

## Task: security fix: find injection risks, authz gaps, secret leaks, unsafe deserialization, path traversal — write the patched code

## Output Format — WRITE THE CODE, NOT A REPORT

For each issue you find, output this EXACT structure:

### N) Severity: **critical|major|minor**

**File path + function/line range:** `path/to/file.ext::function_name` (LNNN–LNNN)
**Problem description:** 2-3 sentences explaining what is wrong and why it matters.
**Concrete fix:** Show the COMPLETE replacement code in a fenced code block.

```language
// the actual fixed code — not pseudocode, not a description, REAL CODE
// include enough surrounding context that someone can find where to paste it
```

## Rules

- You MUST write actual, copy-pasteable code fixes — not descriptions of what to do
- Every finding MUST include a code block with the corrected implementation
- Do NOT suggest adding documentation, comments, or docstrings — only functional code changes
- Do NOT suggest adding logging unless it fixes an actual bug
- Prioritize by impact: bugs > security > performance > cleanup
- Maximum 15 findings — quality over quantity
- End with: NEXT_AREA: <suggest one unexplored area for future analysis>
