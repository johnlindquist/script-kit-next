<previous-analyses>


Here are the swarm tasks extracted from the analysis:

- `unify-applescript-escape` scope:`src/utils/applescript.rs` — Add newline/CR/tab escaping to canonical `escape_applescript_string` utility
- `fix-execute-type-escape` scope:`src/executor/scriptlet.rs` — Replace inline escape with canonical util to prevent AppleScript injection in scriptlets
- `dedupe-builtin-applescript-escape` scope:`src/app_execute/builtin_execution.rs` — Remove duplicate `applescript_escape` fn, use canonical utility instead

NEXT_AREA: `selected_text::set_selected_text()` clipboard sanitization and TOCTOU race in `execute_paste()`
---


Here are the swarm tasks extracted from the analysis:

- `env-scrub-type-submit-osascript` scope:`src/executor/scriptlet.rs` — Apply env allowlist to osascript calls in execute_type and execute_submit
- `quicklink-query-url-encode` scope:`src/quicklinks/mod.rs` — Percent-encode query string before substituting into URL template
- `scrub-system-actions-env` scope:`src/system_actions/mod.rs` — Scrub environment for osascript/mdls/open spawns in system actions
- `pid-file-permissions` scope:`src/process_manager/mod.rs` — Restrict PID file and directory permissions to owner-only (0o600/0o700)

NEXT_AREA: `src/config/editor.rs` — config.ts write operations (`enable_claude_code_safely`, `recover_from_backup`) and file permission/race-condition hardening
---
Here are the swarm tasks extracted from the Oracle analysis:

- `agent-exec-hardening` scope:`src/agents/executor.rs` — Scrub env, canonicalize agent paths, harden argv in all spawn functions
- `frontmatter-sanitize-fields` scope:`src/agents/parser.rs` — Sanitize _cwd, _command, and _env key/value fields in frontmatter extraction

NEXT_AREA: `build_terminal_command()` call sites — audit shell re-parsing and argument quoting/escaping in terminal/GUI execution paths
---
</previous-analyses>

Do NOT repeat items already covered above. Find something new.
## Target Code

Confirmed: `execute_agent` (line 323), `explain_agent` (line 410), and `dry_run_agent` (line 451) all validate paths. But `build_terminal_command` (line 490) does NOT.

FEATURE: `build_terminal_command()` constructs external terminal execution args from agent path without calling `validate_agent_markdown_path()`, bypassing the path traversal/symlink/extension checks enforced by all other executor functions
FILES: src/agents/executor.rs, src/agents/parser.rs, src/agents/types.rs
SMELL: `build_terminal_command()` at line 490 passes `agent.path` directly to the caller without the canonicalization, parent-dir rejection, extension check, or kit-root containment validation that `execute_agent()`, `explain_agent()`, and `dry_run_agent()` all enforce — allowing a crafted agent path to escape the agents directory when executed in an external terminal

## Task: security fix: find injection risks, authz gaps, secret leaks, unsafe deserialization, path traversal — write the patched code

## CONTEXT: You are generating work orders for a codex-swarm

Your output will be handed DIRECTLY to a `/codex-swarm` dispatcher that spawns parallel Codex AI agents (GPT-5.3) to implement your recommendations. Each task you write becomes a worker that edits real files autonomously. The workers have NO context beyond what you write in the task description — they cannot ask questions.

## Output Format — SWARM TASK LIST

Output 1-4 tasks. For each task, output this EXACT structure:

### Task N: `<worker-id>`

**Scope:** `<glob pattern for files this worker should touch>`

**Task:**
<2-4 paragraphs briefing a senior engineer. Be EXHAUSTIVE — the worker has zero context beyond this text.>

<Paragraph 1: What is wrong, which specific files/functions/lines are involved, and what the fix should accomplish.>

<Paragraph 2: The exact implementation — what code to change, what the replacement should look like, what patterns to follow from the existing codebase. Include function signatures, variable names, types.>

<Paragraph 3: Edge cases and constraints — what NOT to break, what to watch out for, how to verify the fix works.>

## Rules

- Worker IDs must be short kebab-case: `fix-fts-trigger`, `add-search-debounce`, `rm-dead-exports`
- Scope must be a glob: `src/notes/storage.rs`, `src/auth/**/*.ts`, `src/menu_bar/*.rs`
- Each worker should own at most ~10 files. If a fix spans more, split into multiple tasks
- Task descriptions must be SELF-CONTAINED — include file paths, function names, current buggy code snippets, and what the corrected code should look like
- Do NOT suggest adding documentation, comments, or docstrings — only functional code changes
- Do NOT suggest adding logging unless it fixes an actual bug
- Prioritize by impact: bugs > security > performance > cleanup
- Maximum 4 tasks per iteration — fewer is better if they're high-quality
- End with: NEXT_AREA: <suggest one unexplored area for future analysis>
