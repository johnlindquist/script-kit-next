Oracle's security audit is complete. Here's the full **swarm task list** from GPT-5.2 Thinking:

---

## Security Audit Results — Scriptlet Shell Injection

Oracle identified **4 tasks** covering the full attack surface:

### Task 1: `scriptlet-template-escaping`
**Scope:** `src/scriptlets/mod.rs`, `src/executor/scriptlet.rs`

The primary RCE vector — `format_scriptlet()` does raw `str::replace()` to substitute user inputs into shell scripts. Values like `$(rm -rf ~)` pass through unescaped. The fix: implement a `ScriptletDialect` enum and `escape_value(dialect, value)` function with correct per-shell escaping:
- **sh/bash/zsh:** single-quote wrapping with `'` → `'"'"'`
- **powershell:** single-quote with `'` → `''`
- **cmd:** `"` wrapping with `^` escape for special chars
- Reject NUL bytes, apply to both named `{{variables}}` and positional args

### Task 2: `secure-tempfiles-and-permissions`
**Scope:** `src/executor/scriptlet.rs`, `src/app_impl/execution_scripts.rs`

Temp files are predictable (`scriptlet-{pid}.sh`), world-readable (`0o755`), and vulnerable to symlink/race attacks. Fix: use `tempfile::Builder` for atomic random creation, lock permissions to `0o700` (executable) or `0o600` (interpreter-fed). Also fix command-string injection in `open_terminal_with_command()` which concatenates raw `tool` + raw path.

### Task 3: `path-traversal-hardening-and-scriptlet-source-validation`
**Scope:** `src/scriptlets/mod.rs`, `src/app_impl/execution_scripts.rs`

Scriptlet paths from UI/config need canonicalization + base-dir constraint. Reject `..` segments, enforce size limits on scriptlet files (1-2 MiB) to prevent parser DoS. Harden `execute_edit()` and `execute_open()` to reject `file://..` traversal and suspicious URL schemes.

### Task 4: `safer-deserialization-and-env-secret-minimization`
**Scope:** `src/scriptlets/mod.rs`, `src/executor/scriptlet.rs`

Add `#[serde(deny_unknown_fields)]` to metadata structs from YAML frontmatter. Implement `inherit_env: bool` (default `false`) in `ScriptletExecOptions` so `Command::new()` doesn't leak the full parent environment (tokens, credentials) to untrusted scriptlets. Use `cmd.env_clear()` + selective re-add of safe basics (`PATH`, `HOME`, `TEMP`).

---

**NEXT_AREA:** Review `open_terminal_with_command` implementation and the GPUI/UI-side scriptlet selection/permission model for an explicit authorization gate before execution.

Want me to proceed with implementing these fixes, or launch a `/codex-swarm` to parallelize the work?
