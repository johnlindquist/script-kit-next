Got the full Oracle response. Here's the analysis with swarm tasks:

---

## Oracle GPT-5.2 Pro Analysis Results

Oracle identified **2 high-impact security tasks** for the agent executor:

---

### Task 1: `agent-exec-hardening`

**Scope:** `src/agents/executor.rs`

**Task:**
`src/agents/executor.rs` leaks the full parent environment into mdflow child processes because `execute_agent()` (line ~97) calls `Command::new(mdflow_cmd)` without `env_clear()`. Frontmatter `_env` values (lines ~156-159) are additive on top of inherited secrets (tokens, API keys, credentials). The same leak exists in `explain_agent()` and `dry_run_agent()`. Additionally, path trust is too loose (`agent.path` used directly with no canonicalization/containment), and the variables loop (lines ~124-133) passes user-controlled variables directly into argv enabling option/flag manipulation.

**Implementation — 3 hardening layers:**
1. **Environment allowlist scrub** — `env_clear()` + safe allowlist (PATH, HOME, TMPDIR, etc.) applied to all 3 spawn functions + frontmatter `_env` applied on top of the scrubbed base
2. **Agent path canonicalization + containment** — Validate agent path resolves to a real `.md` file under `~/.scriptkit/kit/*/agents/`
3. **Argv hardening** — Normalize variable keys (reject reserved mdflow system flags like `quiet`/`context`/`env`/`command`), reject control chars/newlines in values, insert `--` before positional args

---

### Task 2: `frontmatter-sanitize-fields`

**Scope:** `src/agents/parser.rs`

**Task:**
Frontmatter extraction stores `_cwd` and `_command` verbatim without validation. `_env` parsing accepts any string key/value including empty keys, keys with `=`/NUL, and values with control characters.

**Implementation — Lightweight sanitizers:**
- `sanitize_cwd()`: reject empty, control chars, NUL, `..` components
- `sanitize_command()`: reject empty, control chars, multi-token strings  
- `is_valid_env_key()`: reject empty, NUL, `=`, control chars
- `is_valid_env_val()`: reject NUL bytes
- Raw frontmatter map preserved as-is; only extracted fields get sanitized

---

**NEXT_AREA:** Audit `build_terminal_command()` call sites (terminal/GUI execution paths) to ensure arguments are never re-parsed via a shell layer and "open in terminal" paths are quoted/escaped correctly per-platform.
